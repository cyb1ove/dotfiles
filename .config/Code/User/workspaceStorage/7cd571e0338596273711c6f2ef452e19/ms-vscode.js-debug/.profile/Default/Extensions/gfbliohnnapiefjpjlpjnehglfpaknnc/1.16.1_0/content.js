(()=>{var e={234:function(e){
/*! @license DOMPurify 2.4.7 | (c) Cure53 and other contributors | Released under the Apache license 2.0 and Mozilla Public License 2.0 | github.com/cure53/DOMPurify/blob/2.4.7/LICENSE */
e.exports=function(){"use strict";function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(t)}function t(e,n){return t=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},t(e,n)}function n(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function o(e,r,i){return o=n()?Reflect.construct:function(e,n,o){var r=[null];r.push.apply(r,n);var i=new(Function.bind.apply(e,r));return o&&t(i,o.prototype),i},o.apply(null,arguments)}function r(e){return i(e)||a(e)||s(e)||l()}function i(e){if(Array.isArray(e))return c(e)}function a(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function s(e,t){if(e){if("string"==typeof e)return c(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?c(e,t):void 0}}function c(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}function l(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var u=Object.hasOwnProperty,d=Object.setPrototypeOf,f=Object.isFrozen,p=Object.getPrototypeOf,m=Object.getOwnPropertyDescriptor,h=Object.freeze,g=Object.seal,y=Object.create,v="undefined"!=typeof Reflect&&Reflect,w=v.apply,b=v.construct;w||(w=function(e,t,n){return e.apply(t,n)}),h||(h=function(e){return e}),g||(g=function(e){return e}),b||(b=function(e,t){return o(e,r(t))});var k=M(Array.prototype.forEach),E=M(Array.prototype.pop),S=M(Array.prototype.push),x=M(String.prototype.toLowerCase),C=M(String.prototype.toString),T=M(String.prototype.match),O=M(String.prototype.replace),N=M(String.prototype.indexOf),L=M(String.prototype.trim),_=M(RegExp.prototype.test),A=R(TypeError);function M(e){return function(t){for(var n=arguments.length,o=new Array(n>1?n-1:0),r=1;r<n;r++)o[r-1]=arguments[r];return w(e,t,o)}}function R(e){return function(){for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return b(e,n)}}function I(e,t,n){var o;n=null!==(o=n)&&void 0!==o?o:x,d&&d(e,null);for(var r=t.length;r--;){var i=t[r];if("string"==typeof i){var a=n(i);a!==i&&(f(t)||(t[r]=a),i=a)}e[i]=!0}return e}function P(e){var t,n=y(null);for(t in e)!0===w(u,e,[t])&&(n[t]=e[t]);return n}function U(e,t){for(;null!==e;){var n=m(e,t);if(n){if(n.get)return M(n.get);if("function"==typeof n.value)return M(n.value)}e=p(e)}function o(e){return console.warn("fallback value for",e),null}return o}var F=h(["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dialog","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","section","select","shadow","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"]),D=h(["svg","a","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","filter","font","g","glyph","glyphref","hkern","image","line","lineargradient","marker","mask","metadata","mpath","path","pattern","polygon","polyline","radialgradient","rect","stop","style","switch","symbol","text","textpath","title","tref","tspan","view","vkern"]),H=h(["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence"]),B=h(["animate","color-profile","cursor","discard","fedropshadow","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignobject","hatch","hatchpath","mesh","meshgradient","meshpatch","meshrow","missing-glyph","script","set","solidcolor","unknown","use"]),K=h(["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover"]),q=h(["maction","maligngroup","malignmark","mlongdiv","mscarries","mscarry","msgroup","mstack","msline","msrow","semantics","annotation","annotation-xml","mprescripts","none"]),j=h(["#text"]),W=h(["accept","action","align","alt","autocapitalize","autocomplete","autopictureinpicture","autoplay","background","bgcolor","border","capture","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","controls","controlslist","coords","crossorigin","datetime","decoding","default","dir","disabled","disablepictureinpicture","disableremoteplayback","download","draggable","enctype","enterkeyhint","face","for","headers","height","hidden","high","href","hreflang","id","inputmode","integrity","ismap","kind","label","lang","list","loading","loop","low","max","maxlength","media","method","min","minlength","multiple","muted","name","nonce","noshade","novalidate","nowrap","open","optimum","pattern","placeholder","playsinline","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","sizes","span","srclang","start","src","srcset","step","style","summary","tabindex","title","translate","type","usemap","valign","value","width","xmlns","slot"]),z=h(["accent-height","accumulate","additive","alignment-baseline","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","class","clip","clippathunits","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","fill","fill-opacity","fill-rule","filter","filterunits","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","height","href","id","image-rendering","in","in2","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lang","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","media","method","mode","min","name","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","preserveaspectratio","primitiveunits","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","specularconstant","specularexponent","spreadmethod","startoffset","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","style","surfacescale","systemlanguage","tabindex","targetx","targety","transform","transform-origin","text-anchor","text-decoration","text-rendering","textlength","type","u1","u2","unicode","values","viewbox","visibility","version","vert-adv-y","vert-origin-x","vert-origin-y","width","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","xmlns","y","y1","y2","z","zoomandpan"]),V=h(["accent","accentunder","align","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","dir","display","displaystyle","encoding","fence","frame","height","href","id","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","width","xmlns"]),G=h(["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),Q=g(/\{\{[\w\W]*|[\w\W]*\}\}/gm),$=g(/<%[\w\W]*|[\w\W]*%>/gm),Y=g(/\${[\w\W]*}/gm),J=g(/^data-[\-\w.\u00B7-\uFFFF]/),X=g(/^aria-[\-\w]+$/),Z=g(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|cid|xmpp):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i),ee=g(/^(?:\w+script|data):/i),te=g(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g),ne=g(/^html$/i),oe=function(){return"undefined"==typeof window?null:window},re=function(t,n){if("object"!==e(t)||"function"!=typeof t.createPolicy)return null;var o=null,r="data-tt-policy-suffix";n.currentScript&&n.currentScript.hasAttribute(r)&&(o=n.currentScript.getAttribute(r));var i="dompurify"+(o?"#"+o:"");try{return t.createPolicy(i,{createHTML:function(e){return e},createScriptURL:function(e){return e}})}catch(e){return console.warn("TrustedTypes policy "+i+" could not be created."),null}};function ie(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:oe(),n=function(e){return ie(e)};if(n.version="2.4.7",n.removed=[],!t||!t.document||9!==t.document.nodeType)return n.isSupported=!1,n;var o=t.document,i=t.document,a=t.DocumentFragment,s=t.HTMLTemplateElement,c=t.Node,l=t.Element,u=t.NodeFilter,d=t.NamedNodeMap,f=void 0===d?t.NamedNodeMap||t.MozNamedAttrMap:d,p=t.HTMLFormElement,m=t.DOMParser,g=t.trustedTypes,y=l.prototype,v=U(y,"cloneNode"),w=U(y,"nextSibling"),b=U(y,"childNodes"),M=U(y,"parentNode");if("function"==typeof s){var R=i.createElement("template");R.content&&R.content.ownerDocument&&(i=R.content.ownerDocument)}var ae=re(g,o),se=ae?ae.createHTML(""):"",ce=i,le=ce.implementation,ue=ce.createNodeIterator,de=ce.createDocumentFragment,fe=ce.getElementsByTagName,pe=o.importNode,me={};try{me=P(i).documentMode?i.documentMode:{}}catch(e){}var he={};n.isSupported="function"==typeof M&&le&&void 0!==le.createHTMLDocument&&9!==me;var ge,ye,ve=Q,we=$,be=Y,ke=J,Ee=X,Se=ee,xe=te,Ce=Z,Te=null,Oe=I({},[].concat(r(F),r(D),r(H),r(K),r(j))),Ne=null,Le=I({},[].concat(r(W),r(z),r(V),r(G))),_e=Object.seal(Object.create(null,{tagNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},allowCustomizedBuiltInElements:{writable:!0,configurable:!1,enumerable:!0,value:!1}})),Ae=null,Me=null,Re=!0,Ie=!0,Pe=!1,Ue=!0,Fe=!1,De=!1,He=!1,Be=!1,Ke=!1,qe=!1,je=!1,We=!0,ze=!1,Ve="user-content-",Ge=!0,Qe=!1,$e={},Ye=null,Je=I({},["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","noscript","plaintext","script","style","svg","template","thead","title","video","xmp"]),Xe=null,Ze=I({},["audio","video","img","source","image","track"]),et=null,tt=I({},["alt","class","for","id","label","name","pattern","placeholder","role","summary","title","value","style","xmlns"]),nt="http://www.w3.org/1998/Math/MathML",ot="http://www.w3.org/2000/svg",rt="http://www.w3.org/1999/xhtml",it=rt,at=!1,st=null,ct=I({},[nt,ot,rt],C),lt=["application/xhtml+xml","text/html"],ut="text/html",dt=null,ft=i.createElement("form"),pt=function(e){return e instanceof RegExp||e instanceof Function},mt=function(t){dt&&dt===t||(t&&"object"===e(t)||(t={}),t=P(t),ge=ge=-1===lt.indexOf(t.PARSER_MEDIA_TYPE)?ut:t.PARSER_MEDIA_TYPE,ye="application/xhtml+xml"===ge?C:x,Te="ALLOWED_TAGS"in t?I({},t.ALLOWED_TAGS,ye):Oe,Ne="ALLOWED_ATTR"in t?I({},t.ALLOWED_ATTR,ye):Le,st="ALLOWED_NAMESPACES"in t?I({},t.ALLOWED_NAMESPACES,C):ct,et="ADD_URI_SAFE_ATTR"in t?I(P(tt),t.ADD_URI_SAFE_ATTR,ye):tt,Xe="ADD_DATA_URI_TAGS"in t?I(P(Ze),t.ADD_DATA_URI_TAGS,ye):Ze,Ye="FORBID_CONTENTS"in t?I({},t.FORBID_CONTENTS,ye):Je,Ae="FORBID_TAGS"in t?I({},t.FORBID_TAGS,ye):{},Me="FORBID_ATTR"in t?I({},t.FORBID_ATTR,ye):{},$e="USE_PROFILES"in t&&t.USE_PROFILES,Re=!1!==t.ALLOW_ARIA_ATTR,Ie=!1!==t.ALLOW_DATA_ATTR,Pe=t.ALLOW_UNKNOWN_PROTOCOLS||!1,Ue=!1!==t.ALLOW_SELF_CLOSE_IN_ATTR,Fe=t.SAFE_FOR_TEMPLATES||!1,De=t.WHOLE_DOCUMENT||!1,Ke=t.RETURN_DOM||!1,qe=t.RETURN_DOM_FRAGMENT||!1,je=t.RETURN_TRUSTED_TYPE||!1,Be=t.FORCE_BODY||!1,We=!1!==t.SANITIZE_DOM,ze=t.SANITIZE_NAMED_PROPS||!1,Ge=!1!==t.KEEP_CONTENT,Qe=t.IN_PLACE||!1,Ce=t.ALLOWED_URI_REGEXP||Ce,it=t.NAMESPACE||rt,_e=t.CUSTOM_ELEMENT_HANDLING||{},t.CUSTOM_ELEMENT_HANDLING&&pt(t.CUSTOM_ELEMENT_HANDLING.tagNameCheck)&&(_e.tagNameCheck=t.CUSTOM_ELEMENT_HANDLING.tagNameCheck),t.CUSTOM_ELEMENT_HANDLING&&pt(t.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)&&(_e.attributeNameCheck=t.CUSTOM_ELEMENT_HANDLING.attributeNameCheck),t.CUSTOM_ELEMENT_HANDLING&&"boolean"==typeof t.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements&&(_e.allowCustomizedBuiltInElements=t.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements),Fe&&(Ie=!1),qe&&(Ke=!0),$e&&(Te=I({},r(j)),Ne=[],!0===$e.html&&(I(Te,F),I(Ne,W)),!0===$e.svg&&(I(Te,D),I(Ne,z),I(Ne,G)),!0===$e.svgFilters&&(I(Te,H),I(Ne,z),I(Ne,G)),!0===$e.mathMl&&(I(Te,K),I(Ne,V),I(Ne,G))),t.ADD_TAGS&&(Te===Oe&&(Te=P(Te)),I(Te,t.ADD_TAGS,ye)),t.ADD_ATTR&&(Ne===Le&&(Ne=P(Ne)),I(Ne,t.ADD_ATTR,ye)),t.ADD_URI_SAFE_ATTR&&I(et,t.ADD_URI_SAFE_ATTR,ye),t.FORBID_CONTENTS&&(Ye===Je&&(Ye=P(Ye)),I(Ye,t.FORBID_CONTENTS,ye)),Ge&&(Te["#text"]=!0),De&&I(Te,["html","head","body"]),Te.table&&(I(Te,["tbody"]),delete Ae.tbody),h&&h(t),dt=t)},ht=I({},["mi","mo","mn","ms","mtext"]),gt=I({},["foreignobject","desc","title","annotation-xml"]),yt=I({},["title","style","font","a","script"]),vt=I({},D);I(vt,H),I(vt,B);var wt=I({},K);I(wt,q);var bt=function(e){var t=M(e);t&&t.tagName||(t={namespaceURI:it,tagName:"template"});var n=x(e.tagName),o=x(t.tagName);return!!st[e.namespaceURI]&&(e.namespaceURI===ot?t.namespaceURI===rt?"svg"===n:t.namespaceURI===nt?"svg"===n&&("annotation-xml"===o||ht[o]):Boolean(vt[n]):e.namespaceURI===nt?t.namespaceURI===rt?"math"===n:t.namespaceURI===ot?"math"===n&&gt[o]:Boolean(wt[n]):e.namespaceURI===rt?!(t.namespaceURI===ot&&!gt[o])&&!(t.namespaceURI===nt&&!ht[o])&&!wt[n]&&(yt[n]||!vt[n]):!("application/xhtml+xml"!==ge||!st[e.namespaceURI]))},kt=function(e){S(n.removed,{element:e});try{e.parentNode.removeChild(e)}catch(t){try{e.outerHTML=se}catch(t){e.remove()}}},Et=function(e,t){try{S(n.removed,{attribute:t.getAttributeNode(e),from:t})}catch(e){S(n.removed,{attribute:null,from:t})}if(t.removeAttribute(e),"is"===e&&!Ne[e])if(Ke||qe)try{kt(t)}catch(e){}else try{t.setAttribute(e,"")}catch(e){}},St=function(e){var t,n;if(Be)e="<remove></remove>"+e;else{var o=T(e,/^[\r\n\t ]+/);n=o&&o[0]}"application/xhtml+xml"===ge&&it===rt&&(e='<html xmlns="http://www.w3.org/1999/xhtml"><head></head><body>'+e+"</body></html>");var r=ae?ae.createHTML(e):e;if(it===rt)try{t=(new m).parseFromString(r,ge)}catch(e){}if(!t||!t.documentElement){t=le.createDocument(it,"template",null);try{t.documentElement.innerHTML=at?se:r}catch(e){}}var a=t.body||t.documentElement;return e&&n&&a.insertBefore(i.createTextNode(n),a.childNodes[0]||null),it===rt?fe.call(t,De?"html":"body")[0]:De?t.documentElement:a},xt=function(e){return ue.call(e.ownerDocument||e,e,u.SHOW_ELEMENT|u.SHOW_COMMENT|u.SHOW_TEXT,null,!1)},Ct=function(e){return e instanceof p&&("string"!=typeof e.nodeName||"string"!=typeof e.textContent||"function"!=typeof e.removeChild||!(e.attributes instanceof f)||"function"!=typeof e.removeAttribute||"function"!=typeof e.setAttribute||"string"!=typeof e.namespaceURI||"function"!=typeof e.insertBefore||"function"!=typeof e.hasChildNodes)},Tt=function(t){return"object"===e(c)?t instanceof c:t&&"object"===e(t)&&"number"==typeof t.nodeType&&"string"==typeof t.nodeName},Ot=function(e,t,o){he[e]&&k(he[e],(function(e){e.call(n,t,o,dt)}))},Nt=function(e){var t;if(Ot("beforeSanitizeElements",e,null),Ct(e))return kt(e),!0;if(_(/[\u0080-\uFFFF]/,e.nodeName))return kt(e),!0;var o=ye(e.nodeName);if(Ot("uponSanitizeElement",e,{tagName:o,allowedTags:Te}),e.hasChildNodes()&&!Tt(e.firstElementChild)&&(!Tt(e.content)||!Tt(e.content.firstElementChild))&&_(/<[/\w]/g,e.innerHTML)&&_(/<[/\w]/g,e.textContent))return kt(e),!0;if("select"===o&&_(/<template/i,e.innerHTML))return kt(e),!0;if(!Te[o]||Ae[o]){if(!Ae[o]&&_t(o)){if(_e.tagNameCheck instanceof RegExp&&_(_e.tagNameCheck,o))return!1;if(_e.tagNameCheck instanceof Function&&_e.tagNameCheck(o))return!1}if(Ge&&!Ye[o]){var r=M(e)||e.parentNode,i=b(e)||e.childNodes;if(i&&r)for(var a=i.length-1;a>=0;--a)r.insertBefore(v(i[a],!0),w(e))}return kt(e),!0}return e instanceof l&&!bt(e)?(kt(e),!0):"noscript"!==o&&"noembed"!==o&&"noframes"!==o||!_(/<\/no(script|embed|frames)/i,e.innerHTML)?(Fe&&3===e.nodeType&&(t=e.textContent,t=O(t,ve," "),t=O(t,we," "),t=O(t,be," "),e.textContent!==t&&(S(n.removed,{element:e.cloneNode()}),e.textContent=t)),Ot("afterSanitizeElements",e,null),!1):(kt(e),!0)},Lt=function(e,t,n){if(We&&("id"===t||"name"===t)&&(n in i||n in ft))return!1;if(Ie&&!Me[t]&&_(ke,t));else if(Re&&_(Ee,t));else if(!Ne[t]||Me[t]){if(!(_t(e)&&(_e.tagNameCheck instanceof RegExp&&_(_e.tagNameCheck,e)||_e.tagNameCheck instanceof Function&&_e.tagNameCheck(e))&&(_e.attributeNameCheck instanceof RegExp&&_(_e.attributeNameCheck,t)||_e.attributeNameCheck instanceof Function&&_e.attributeNameCheck(t))||"is"===t&&_e.allowCustomizedBuiltInElements&&(_e.tagNameCheck instanceof RegExp&&_(_e.tagNameCheck,n)||_e.tagNameCheck instanceof Function&&_e.tagNameCheck(n))))return!1}else if(et[t]);else if(_(Ce,O(n,xe,"")));else if("src"!==t&&"xlink:href"!==t&&"href"!==t||"script"===e||0!==N(n,"data:")||!Xe[e])if(Pe&&!_(Se,O(n,xe,"")));else if(n)return!1;return!0},_t=function(e){return e.indexOf("-")>0},At=function(t){var o,r,i,a;Ot("beforeSanitizeAttributes",t,null);var s=t.attributes;if(s){var c={attrName:"",attrValue:"",keepAttr:!0,allowedAttributes:Ne};for(a=s.length;a--;){var l=o=s[a],u=l.name,d=l.namespaceURI;if(r="value"===u?o.value:L(o.value),i=ye(u),c.attrName=i,c.attrValue=r,c.keepAttr=!0,c.forceKeepAttr=void 0,Ot("uponSanitizeAttribute",t,c),r=c.attrValue,!c.forceKeepAttr&&(Et(u,t),c.keepAttr))if(Ue||!_(/\/>/i,r)){Fe&&(r=O(r,ve," "),r=O(r,we," "),r=O(r,be," "));var f=ye(t.nodeName);if(Lt(f,i,r)){if(!ze||"id"!==i&&"name"!==i||(Et(u,t),r=Ve+r),ae&&"object"===e(g)&&"function"==typeof g.getAttributeType)if(d);else switch(g.getAttributeType(f,i)){case"TrustedHTML":r=ae.createHTML(r);break;case"TrustedScriptURL":r=ae.createScriptURL(r)}try{d?t.setAttributeNS(d,u,r):t.setAttribute(u,r),E(n.removed)}catch(e){}}}else Et(u,t)}Ot("afterSanitizeAttributes",t,null)}},Mt=function e(t){var n,o=xt(t);for(Ot("beforeSanitizeShadowDOM",t,null);n=o.nextNode();)Ot("uponSanitizeShadowNode",n,null),Nt(n)||(n.content instanceof a&&e(n.content),At(n));Ot("afterSanitizeShadowDOM",t,null)};return n.sanitize=function(r){var i,s,l,u,d,f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if((at=!r)&&(r="\x3c!--\x3e"),"string"!=typeof r&&!Tt(r)){if("function"!=typeof r.toString)throw A("toString is not a function");if("string"!=typeof(r=r.toString()))throw A("dirty is not a string, aborting")}if(!n.isSupported){if("object"===e(t.toStaticHTML)||"function"==typeof t.toStaticHTML){if("string"==typeof r)return t.toStaticHTML(r);if(Tt(r))return t.toStaticHTML(r.outerHTML)}return r}if(He||mt(f),n.removed=[],"string"==typeof r&&(Qe=!1),Qe){if(r.nodeName){var p=ye(r.nodeName);if(!Te[p]||Ae[p])throw A("root node is forbidden and cannot be sanitized in-place")}}else if(r instanceof c)1===(s=(i=St("\x3c!----\x3e")).ownerDocument.importNode(r,!0)).nodeType&&"BODY"===s.nodeName||"HTML"===s.nodeName?i=s:i.appendChild(s);else{if(!Ke&&!Fe&&!De&&-1===r.indexOf("<"))return ae&&je?ae.createHTML(r):r;if(!(i=St(r)))return Ke?null:je?se:""}i&&Be&&kt(i.firstChild);for(var m=xt(Qe?r:i);l=m.nextNode();)3===l.nodeType&&l===u||Nt(l)||(l.content instanceof a&&Mt(l.content),At(l),u=l);if(u=null,Qe)return r;if(Ke){if(qe)for(d=de.call(i.ownerDocument);i.firstChild;)d.appendChild(i.firstChild);else d=i;return(Ne.shadowroot||Ne.shadowrootmod)&&(d=pe.call(o,d,!0)),d}var h=De?i.outerHTML:i.innerHTML;return De&&Te["!doctype"]&&i.ownerDocument&&i.ownerDocument.doctype&&i.ownerDocument.doctype.name&&_(ne,i.ownerDocument.doctype.name)&&(h="<!DOCTYPE "+i.ownerDocument.doctype.name+">\n"+h),Fe&&(h=O(h,ve," "),h=O(h,we," "),h=O(h,be," ")),ae&&je?ae.createHTML(h):h},n.setConfig=function(e){mt(e),He=!0},n.clearConfig=function(){dt=null,He=!1},n.isValidAttribute=function(e,t,n){dt||mt({});var o=ye(e),r=ye(t);return Lt(o,r,n)},n.addHook=function(e,t){"function"==typeof t&&(he[e]=he[e]||[],S(he[e],t))},n.removeHook=function(e){if(he[e])return E(he[e])},n.removeHooks=function(e){he[e]&&(he[e]=[])},n.removeAllHooks=function(){he={}},n}return ie()}()},34:e=>{e.exports=function(e){const{addSearchAlias:t,cmap:n,getBrowserName:o,getFormData:r,map:i,mapkey:a,readText:s,tabOpenLink:c,vmapkey:l,Clipboard:u,Hints:d,Front:f,RUNTIME:p}=e;function m(){var e=[];return document.querySelectorAll("table").forEach((function(t){var n=t.querySelector("tr");n&&e.push(...n.children)})),e}function h(e){return(e.method||"get")+"::"+new URL(e.action).pathname}i("g0",":feedkeys 99E",0,"#3Go to the first tab"),i("g$",":feedkeys 99R",0,"#3Go to the last tab"),a("zr","#3zoom reset",(function(){p("setZoom",{zoomFactor:0})})),a("zi","#3zoom in",(function(){p("setZoom",{zoomFactor:.1})})),a("zo","#3zoom out",(function(){p("setZoom",{zoomFactor:-.1})})),i("ZQ",":quit"),a("ZZ","#5Save session and quit",(function(){p("createSession",{name:"LAST",quitAfterSaved:!0})})),a("ZR","#5Restore last session",(function(){p("openSession",{name:"LAST"})})),i("u","e"),a("af","#1Open a link in active new tab",(function(){d.create("",d.dispatchMouseClick,{tabbed:!0,active:!0})})),a("gf","#1Open a link in non-active new tab",(function(){d.create("",d.dispatchMouseClick,{tabbed:!0,active:!1})})),a("cf","#1Open multiple links in a new tab",(function(){d.create("",d.dispatchMouseClick,{multipleHits:!0})})),i("C","gf"),a("<Ctrl-h>","#1Mouse over elements.",(function(){d.create("",((e,t)=>{if(chrome.surfingkeys){const t=e.getClientRects()[0];chrome.surfingkeys.sendMouseEvent(2,Math.round(t.x+t.width/2),Math.round(t.y+t.height/2),0)}else d.dispatchMouseClick(e,t)}),{mouseEvents:["mouseover"]})})),a("<Ctrl-j>","#1Mouse out elements.",(function(){d.create("",d.dispatchMouseClick,{mouseEvents:["mouseout"]})})),a("ya","#7Copy a link URL to the clipboard",(function(){d.create("*[href]",(function(e){u.write(e.href)}))})),a("yma","#7Copy multiple link URLs to the clipboard",(function(){var e=[];d.create("*[href]",(function(t){e.push(t.href),u.write(e.join("\n"))}),{multipleHits:!0})})),a("yc","#7Copy a column of a table",(function(){d.create(m(),(function(e){var t=Array.from(e.closest("table").querySelectorAll("tr")).map((function(t){return t.children.length>e.cellIndex?t.children[e.cellIndex].innerText:""}));u.write(t.join("\n"))}))})),a("ymc","#7Copy multiple columns of a table",(function(){var e=null;d.create(m(),(function(t){var n=Array.from(t.closest("table").querySelectorAll("tr")).map((function(e){return e.children.length>t.cellIndex?e.children[t.cellIndex].innerText:""}));e?n.forEach((function(t,n){e[n]+="\t"+t})):e=n,u.write(e.join("\n"))}),{multipleHits:!0})})),a("yq","#7Copy pre text",(function(){d.create("pre",(function(e){u.write(e.innerText)}))})),i("<Ctrl-i>","I"),n("<ArrowDown>","<Tab>"),n("<ArrowUp>","<Shift-Tab>"),n("<Ctrl-n>","<Tab>"),n("<Ctrl-p>","<Shift-Tab>"),a("q","#1Click on an Image or a button",(function(){d.create("img, button",d.dispatchMouseClick)})),a("<Alt-p>","#3pin/unpin current tab",(function(){p("togglePinTab")})),a("<Alt-m>","#3mute/unmute current tab",(function(){p("muteTab")})),a("B","#4Go one tab history back",(function(){p("historyTab",{backward:!0})}),{repeatIgnore:!0}),a("F","#4Go one tab history forward",(function(){p("historyTab",{backward:!1})}),{repeatIgnore:!0}),a("<Ctrl-6>","#4Go to last used tab",(function(){p("goToLastTab")})),a("gT","#4Go to first activated tab",(function(){p("historyTab",{index:0})}),{repeatIgnore:!0}),a("gt","#4Go to last activated tab",(function(){p("historyTab",{index:-1})}),{repeatIgnore:!0}),a("gp","#4Go to the playing tab",(function(){p("getTabs",{queryInfo:{audible:!0}},(e=>{e.tabs?.at(0)&&(tab=e.tabs[0],p("focusTab",{windowId:tab.windowId,tabId:tab.id}))}))}),{repeatIgnore:!0}),a("S","#4Go back in history",(function(){history.go(-1)}),{repeatIgnore:!0}),a("D","#4Go forward in history",(function(){history.go(1)}),{repeatIgnore:!0}),a("r","#4Reload the page",(function(){p("reloadTab",{nocache:!1})})),a("oi","#8Open incognito window",(function(){p("openIncognito",{url:window.location.href})})),a("H","#8Open opened URL in current tab",(function(){f.openOmnibar({type:"TabURLs"})})),a("om","#8Open URL from vim-like marks",(function(){f.openOmnibar({type:"VIMarks"})})),a(":","#8Open commands",(function(){f.openOmnibar({type:"Commands"})})),a("yi","#7Yank text of an input",(function(){d.create("input, textarea, select",(function(e){u.write(e.value)}))})),a("x","#3Close current tab",(function(){p("closeTab")})),a(";w","#2Focus top window",(function(){top.focus()})),a("cc","#7Open selected link or link from clipboard",(function(){window.getSelection().toString()?c(window.getSelection().toString()):u.read((function(e){c(e.data)}))})),a(";cq","#7Clear all URLs in queue to be opened",(function(){p("clearQueueURLs")})),a("ys","#7Copy current page's source",(function(){var e=document.documentElement.cloneNode(!0);u.write(e.outerHTML)})),a("yj","#7Copy current settings",(function(){p("getSettings",{key:"RAW"},(function(e){u.write(JSON.stringify(e.settings,null,4))}))})),a(";pj","#7Restore settings data from clipboard",(function(){u.read((function(e){p("updateSettings",{settings:JSON.parse(e.data.trim())})}))})),a("yt","#3Duplicate current tab",(function(){p("duplicateTab")})),a("yT","#3Duplicate current tab in background",(function(){p("duplicateTab",{active:!1})})),a("yy","#7Copy current page's URL",(function(){var e=window.location.href;0===e.indexOf(chrome.extension.getURL("/pages/pdf_viewer.html"))&&(e=window.location.search.substr(3)),u.write(e)})),a("yY","#7Copy all tabs's url",(function(){p("getTabs",null,(function(e){u.write(e.tabs.map((e=>e.url)).join("\n"))}))})),a("yh","#7Copy current page's host",(function(){var e=new URL(window.location.href);u.write(e.host)})),a("yl","#7Copy current page's title",(function(){u.write(document.title)})),a("yQ","#7Copy all query history of OmniQuery.",(function(){p("getSettings",{key:"OmniQueryHistory"},(function(e){u.write(e.settings.OmniQueryHistory.join("\n"))}))})),a("yf","#7Copy form data in JSON on current page",(function(){var e={};document.querySelectorAll("form").forEach((function(t){e[h(t)]=r(t,"json")})),u.write(JSON.stringify(e,null,4))})),a(";pf","#7Fill form with data from yf",(function(){d.create("form",(function(e,t){var n=h(e);u.read((function(t){var o=JSON.parse(t.data.trim());if(o.hasOwnProperty(n)){var r=o[n];e.querySelectorAll("input, textarea").forEach((function(t){if(r.hasOwnProperty(t.name)&&"hidden"!==t.type)if("radio"===t.type){var n=e.querySelector(`input[name='${t.name}'][value='${r[t.name]}']`);n&&(n.checked=!0)}else if(Array.isArray(r[t.name])){e.querySelectorAll(`input[name='${t.name}']`).forEach((function(e){e.checked=!1})),r[t.name].forEach((function(n){var o=e.querySelector(`input[name='${t.name}'][value='${n}']`);o&&(o.checked=!0)}))}else"string"==typeof r[t.name]&&(t.value=r[t.name])}))}else f.showBanner("No form data found for your selection from clipboard.")}))}))})),a("yp","#7Copy form data for POST on current page",(function(){var e=[];document.querySelectorAll("form").forEach((function(t){var n={};n[(t.method||"get")+"::"+t.action]=r(t),e.push(n)})),u.write(JSON.stringify(e,null,4))})),a("g?","#4Reload current page without query string(all parts after question mark)",(function(){window.location.href=window.location.href.replace(/\?[^\?]*$/,"")})),a("g#","#4Reload current page without hash fragment",(function(){window.location.href=window.location.href.replace(/\#[^\#]*$/,"")})),a("gU","#4Go to root of current URL hierarchy",(function(){window.location.href=window.location.origin})),a("gxt","#3Close tab on left",(function(){p("closeTabLeft")})),a("gxT","#3Close tab on right",(function(){p("closeTabRight")})),a("gx0","#3Close all tabs on left",(function(){p("closeTabsToLeft")})),a("gx$","#3Close all tabs on right",(function(){p("closeTabsToRight")})),a("gxx","#3Close all tabs except current one",(function(){p("tabOnly")})),a("gxp","#3Close playing tab",(function(){p("closeAudibleTab")})),a(";e","#11Edit Settings",(function(){c("/pages/options.html")})),a(";u","#4Edit current URL with vim editor, and open in new tab",(function(){f.showEditor(window.location.href,(function(e){c(e)}),"url")})),a(";U","#4Edit current URL with vim editor, and reload",(function(){f.showEditor(window.location.href,(function(e){window.location.href=e}),"url")})),t("g","google","https://www.google.com/search?q=","s","https://www.google.com/complete/search?client=chrome-omni&gs_ri=chrome-ext&oit=1&cp=1&pgcl=7&q=",(function(e){return JSON.parse(e.text)[1]})),t("d","duckduckgo","https://duckduckgo.com/?q=","s","https://duckduckgo.com/ac/?q=",(function(e){return JSON.parse(e.text).map((function(e){return e.phrase}))})),t("b","baidu","https://www.baidu.com/s?wd=","s","https://suggestion.baidu.com/su?cb=&wd=",(function(e){var t=e.text.match(/,s:\[("[^\]]+")]}/);return t?t[1].replace(/"/g,"").split(","):[]})),t("e","wikipedia","https://en.wikipedia.org/wiki/","s","https://en.wikipedia.org/w/api.php?action=opensearch&format=json&formatversion=2&namespace=0&limit=40&search=",(function(e){return JSON.parse(e.text)[1]})),t("w","bing","https://www.bing.com/search?setmkt=en-us&setlang=en-us&q=","s","https://api.bing.com/osjson.aspx?query=",(function(e){return JSON.parse(e.text)[1]})),t("s","stackoverflow","https://stackoverflow.com/search?q="),t("h","github","https://github.com/search?q=","s","https://api.github.com/search/repositories?order=desc&q=",(function(e){var t=JSON.parse(e.text).items;return t?t.map((function(e){return{title:e.description,url:e.html_url}})):[]})),t("y","youtube","https://www.youtube.com/results?search_query=","s","https://clients1.google.com/complete/search?client=youtube&ds=yt&callback=cb&q=",(function(e){return JSON.parse(e.text.substr(9,e.text.length-10))[1].map((function(e){return e[0]}))}));const g=o();"Firefox"===g?a("on","#3Open newtab",(function(){c("about:blank")})):"Chrome"===g&&(a("cp","#13Toggle proxy for current site",(function(){var e=window.location.host.replace(/:\d+/,"");e&&e.length&&p("updateProxy",{host:e,operation:"toggle"})})),a(";cp","#13Copy proxy info",(function(){p("getSettings",{key:["proxyMode","proxy","autoproxy_hosts"]},(function(e){u.write(JSON.stringify(e.settings,null,4))}))})),a(";ap","#13Apply proxy info from clipboard",(function(){u.read((function(e){var t=JSON.parse(e.data);p("updateProxy",{operation:"set",host:t.autoproxy_hosts,proxy:t.proxy,mode:t.proxyMode})}))})),i(";pa",":setProxyMode always",0,"#13set proxy mode `always`"),i(";pb",":setProxyMode byhost",0,"#13set proxy mode `byhost`"),i(";pd",":setProxyMode direct",0,"#13set proxy mode `direct`"),i(";ps",":setProxyMode system",0,"#13set proxy mode `system`"),i(";pc",":setProxyMode clear",0,"#13set proxy mode `clear`"),a("gr","#14Read selected text or text from clipboard",(function(){u.read((function(e){s(window.getSelection().toString()||e.data,{verbose:!0})}))})),l("gr","#9Read selected text",(function(){s(window.getSelection().toString(),{verbose:!0})})),a("on","#3Open newtab",(function(){c("chrome://newtab/")})),a("ga","#12Open Chrome About",(function(){c("chrome://help/")})),a("gb","#12Open Chrome Bookmarks",(function(){c("chrome://bookmarks/")})),a("gc","#12Open Chrome Cache",(function(){c("chrome://cache/")})),a("gd","#12Open Chrome Downloads",(function(){c("chrome://downloads/")})),a("gh","#12Open Chrome History",(function(){c("chrome://history/")})),a("gk","#12Open Chrome Cookies",(function(){c("chrome://settings/cookies")})),a("ge","#12Open Chrome Extensions",(function(){c("chrome://extensions/")})),a("gn","#12Open Chrome net-internals",(function(){c("chrome://net-internals/#proxy")})),a(";i","#12Open Chrome Inspect",(function(){c("chrome://inspect/#devices")})),a(";v","#11Open neovim",(function(){c("/pages/neovim.html")})),a("<Ctrl-Alt-i>","#1Go to edit box with neovim editor",(function(){d.create("input, textarea, *[contenteditable=true], select",(function(e){f.showEditor(e,null,null,!0)}))}))),o().startsWith("Safari")||(a("t","#8Open a URL",(function(){f.openOmnibar({type:"URLs"})})),a("go","#8Open a URL in current tab",(function(){f.openOmnibar({type:"URLs",tabbed:!1})})),a("ox","#8Open recently closed URL",(function(){f.openOmnibar({type:"RecentlyClosed"})})),a("X","#3Restore closed tab",(function(){p("openLast")})),a("b","#8Open a bookmark",(function(){f.openOmnibar({type:"Bookmarks"})})),a("ab","#8Bookmark current page to selected folder",(function(){var e={url:window.location.href,title:document.title};f.openOmnibar({type:"AddBookmark",extra:e})})),a("oh","#8Open URL from history",(function(){f.openOmnibar({type:"History"})})),a("W","#3Move current tab to another window",(function(){f.openOmnibar({type:"Windows"})})),a(";gt","#3Gather filtered tabs into current window",(function(){f.openOmnibar({type:"Tabs",extra:{action:"gather"}})})),a(";gw","#3Gather all tabs into current window",(function(){p("gatherWindows")})),a("<<","#3Move current tab to left",(function(){p("moveTab",{step:-1})})),a(">>","#3Move current tab to right",(function(){p("moveTab",{step:1})})),a("yd","#7Copy current downloading URL",(function(){p("getDownloads",{query:{state:"in_progress"}},(function(e){var t=e.downloads.map((function(e){return e.url}));u.write(t.join(","))}))})),a("gs","#12View page source",(function(){p("viewSource",{tab:{tabbed:!0}})})),a(";pm","#11Preview markdown",(function(){c("/pages/markdown.html")})),a(";di","#1Download image",(function(){d.create("img",(function(e){p("download",{url:e.src})}))})),a(";j","#12Close Downloads Shelf",(function(){p("closeDownloadsShelf",{clearHistory:!0})})),a(";dh","#14Delete history older than 30 days",(function(){p("deleteHistoryOlderThan",{days:30})})),a(";yh","#14Yank histories",(function(){p("getHistory",{},(function(e){u.write(e.history.map((e=>e.url)).join("\n"))}))})),a(";ph","#14Put histories from clipboard",(function(){u.read((function(e){p("addHistories",{history:e.data.split("\n")})}))})),a(";db","#14Remove bookmark for current page",(function(){p("removeBookmark")})))}}},t={};function n(o){var r=t[o];if(void 0!==r)return r.exports;var i=t[o]={exports:{}};return e[o].call(i.exports,i,i.exports,n),i.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var o in t)n.o(t,o)&&!n.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{"use strict";var e=n(234);const t={keyCodesMac:{Minus:["-","_"],Equal:["=","+"],BracketLeft:["[","{"],BracketRight:["]","}"],Backslash:["\\","|"],Semicolon:[";",":"],Quote:["'",'"'],Comma:[",","<"],Period:[".",">"],Slash:["/","?"]},keyCodes:{ESC:27,backspace:8,deleteKey:46,enter:13,ctrlEnter:10,space:32,shiftKey:16,ctrlKey:17,f1:112,f12:123,comma:188,tab:9,downArrow:40,upArrow:38},modifierKeys:{16:"Shift",17:"Ctrl",18:"Alt",91:"Meta",92:"Meta",93:"ContextMenu",229:"Process"},keyNames:{8:"Backspace",9:"Tab",12:"NumLock",27:"Esc",32:"Space",46:"Delete"},keyIdentifierCorrectionMap:{"U+00C0":["U+0060","U+007E"],"U+0030":["U+0030","U+0029"],"U+0031":["U+0031","U+0021"],"U+0032":["U+0032","U+0040"],"U+0033":["U+0033","U+0023"],"U+0034":["U+0034","U+0024"],"U+0035":["U+0035","U+0025"],"U+0036":["U+0036","U+005E"],"U+0037":["U+0037","U+0026"],"U+0038":["U+0038","U+002A"],"U+0039":["U+0039","U+0028"],"U+00BD":["U+002D","U+005F"],"U+00BB":["U+003D","U+002B"],"U+00DB":["U+005B","U+007B"],"U+00DD":["U+005D","U+007D"],"U+00DC":["U+005C","U+007C"],"U+00BA":["U+003B","U+003A"],"U+00DE":["U+0027","U+0022"],"U+00BC":["U+002C","U+003C"],"U+00BE":["U+002E","U+003E"],"U+00BF":["U+002F","U+003F"]}};var o="Windows";function r(e,n){var o,r=0;return-1!==e.indexOf("Ctrl-")&&(r|=1),-1!==e.indexOf("Alt-")&&(r|=2),-1!==e.indexOf("Meta-")&&(r|=4),-1!==e.indexOf("Shift-")&&(r|=8),o=8192+((o=n.length>1?256+t.specialKeys.indexOf(n):n.charCodeAt(0))<<4)+r,String.fromCharCode(o)}"undefined"!=typeof navigator&&(-1!==navigator.platform.indexOf("Mac")?o="Mac":-1!==navigator.userAgent.indexOf("Linux")&&(o="Linux")),t.getKeyChar=function(e){var n;if(e.keyCode in this.modifierKeys)n="";else{if(this.keyNames.hasOwnProperty(e.keyCode))n="{0}".format(this.keyNames[e.keyCode]);else if(n=e.key||"",-1!==["Shift","Meta","Alt","Ctrl"].indexOf(n)&&(n=""),n)n.charCodeAt(0)>127||"Dead"===n?e.keyCode<127?(n=String.fromCharCode(e.keyCode),n=e.shiftKey?n:n.toLowerCase()):this.keyCodesMac.hasOwnProperty(e.code)&&(n=this.keyCodesMac[e.code][e.shiftKey?1:0]):"Unidentified"===n&&(n="");else if(e.keyIdentifier)if("U+"!==e.keyIdentifier.slice(0,2))n="{0}".format(e.keyIdentifier);else{var r=e.keyIdentifier;if(("Windows"===o||"Linux"===o)&&this.keyIdentifierCorrectionMap[r]){var i=this.keyIdentifierCorrectionMap[r];r=e.shiftKey?i[1]:i[0]}var a="0x"+r.substring(2);n=String.fromCharCode(parseInt(a)),n=e.shiftKey?n:n.toLowerCase()}e.shiftKey&&n.length>1&&(n="Shift-"+n),n.length>0&&(e.metaKey&&(n="Meta-"+n),e.altKey&&(n="Alt-"+n),e.ctrlKey&&(n="Ctrl-"+n)),n.length>1&&(n="<{0}>".format(n))}return t.decodeKeystroke(t.encodeKeystroke(n))===n&&(n=t.encodeKeystroke(n)),n},t.isWordChar=function(e){return e.keyCode<123&&e.keyCode>=97||e.keyCode<91&&e.keyCode>=65||e.keyCode<58&&e.keyCode>=48},t.encodeKeystroke=function(e){for(var t,n=/<(?:Ctrl-)?(?:Alt-)?(?:Meta-)?(?:Shift-)?([^>]+|.)>/g,o="",i=0;null!==(t=n.exec(e));)o+=e.substr(i,t.index-i),o+=r(t[0],t[1]),i=n.lastIndex;return o+=e.substr(i)},t.specialKeys=["Esc","Space","F1","F2","F3","F4","F5","F6","F7","F8","F9","F10","F11","F12","ArrowUp","ArrowDown","ArrowLeft","ArrowRight","Backspace","Enter","Tab","Delete","End","Home","Insert","NumLock","PageDown","PageUp","Pause","ScrollLock","CapsLock","PrintScreen","Escape","Hyper"],t.decodeKeystroke=function(e){for(var n="",o=0;o<e.length;o++){var r=e[o].charCodeAt(0);if(r>8192){var i=(r-=8192)%4096>>4,a=15&r;r=r>>12?t.specialKeys[i%256]:String.fromCharCode(i),8&a&&(r="Shift-"+r),4&a&&(r="Meta-"+r),2&a&&(r="Alt-"+r),1&a&&(r="Ctrl-"+r),n+="<"+r+">"}else n+=e[o]}return n};const i=t;function a(e,t){document.dispatchEvent(new CustomEvent(`surfingkeys:${e}`,{detail:t}))}function s(e,t,n){(t=t||{}).action=e,-1!==["closeTab","nextTab","previousTab","moveTab","reloadTab","setZoom","closeTabLeft","closeTabRight","focusTabByIndex"].indexOf(e)&&(t.repeats=s.repeats,s.repeats=1);try{t.needResponse=void 0!==n,chrome.runtime.sendMessage(t,n),"read"===e&&d.on("onTtsEvent",n)}catch(e){a("showPopup",["[runtime exception] "+e])}}var c,l,u,d=(c={conf:{autoSpeakOnInlineQuery:!1,lastKeys:"",blocklistPattern:void 0,lurkingPattern:void 0,smartCase:!0,caseSensitive:!1,clickablePat:/(https?:\/\/|thunder:\/\/|magnet:)\S+/gi,clickableSelector:"",editableSelector:"div.CodeMirror-scroll,div.ace_content",cursorAtEndOfInput:!0,defaultSearchEngine:"g",defaultVoice:"Daniel",editableBodyCare:!0,enableAutoFocus:!0,enableEmojiInsertion:!1,experiment:!1,focusFirstCandidate:!1,focusOnSaved:!0,hintAlign:"center",hintExplicit:!1,hintShiftNonActive:!1,historyMUOrder:!0,language:void 0,lastQuery:"",modeAfterYank:"",nextLinkRegex:/(\b(next)\b)|下页|下一页|后页|下頁|下一頁|後頁|>>|»/i,digitForRepeat:!0,omnibarMaxResults:10,omnibarHistoryCacheSize:100,omnibarPosition:"middle",omnibarSuggestion:!0,omnibarSuggestionTimeout:200,omnibarTabsQuery:{},pageUrlRegex:[],prevLinkRegex:/(\b(prev|previous)\b)|上页|上一页|前页|上頁|上一頁|前頁|<<|«/i,richHintsForKeystroke:1e3,scrollStepSize:70,showModeStatus:!1,showProxyInStatusBar:!1,smartPageBoundary:!1,smoothScroll:!0,startToShowEmoji:2,stealFocusOnLoad:!0,tabsThreshold:100,verticalTabs:!0,textAnchorPat:/(^[\n\r\s]*\S{3,}|\b\S{4,})/g,ignoredFrameHosts:["https://tpc.googlesyndication.com"],scrollFriction:0,aceKeybindings:"vim",caretViewport:null,mouseSelectToQuery:[],useNeovim:!1,useLocalMarkdownAPI:!0}},l={},u=new Promise((function(e,t){window===top?e(window.location.href):s("getTopURL",null,(function(t){e(t.url)}))})),c.on=function(e,t){l[e]=t},c.updateHistory=function(e,t){var n=e+"History";s("getSettings",{key:n},(function(e){var o=e.settings[n]||[],r={};"Array"===t.constructor.name?(r[n]=t,s("updateSettings",{settings:r})):t.trim().length&&"."!==t&&((o=o.filter((function(e){return e.trim().length&&e!==t&&"."!==e}))).unshift(t),o.length>50&&o.pop(),r[n]=o,s("updateSettings",{settings:r}))}))},chrome.runtime.onMessage.addListener((function(e,t,n){l[e.subject]&&l[e.subject](e,t,n)})),c.getTopURL=function(e){u.then((function(t){e(t)}))},c.postTopMessage=function(e){u.then((function(t){window===top&&(t=window.location.origin),"null"!==t&&"file://"!==new URL(t).origin||(t="*"),top.postMessage({surfingkeys_uihost_data:e},t)}))},c.getCaseSensitive=function(e){return c.conf.caseSensitive||c.conf.smartCase&&/[A-Z]/.test(e)},c);function f(){if(-1!==window.navigator.userAgent.indexOf("Chrome"))return"Chrome";if(0===window.navigator.vendor.indexOf("Apple Computer, Inc.")){return/iPad|iPhone|iPod/.test(navigator.platform)||"MacIntel"===navigator.platform&&navigator.maxTouchPoints>1?"Safari-iOS":"Safari"}return-1!==window.navigator.userAgent.indexOf("Firefox")?"Firefox":"Chrome"}function p(){return 0===document.location.href.indexOf(chrome.extension.getURL("/"))}function m(){var e=window.location.origin?window.location.origin:"*";return"file://"!==e&&"null"!==e||(e="*"),e}function h(){return Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)}function g(e,t,n){const o=[];let r;const i=document.createNodeIterator(e,t,null);for(;r=i.nextNode();)n(r)&&o.push(r),r.shadowRoot&&o.push(...g(r.shadowRoot,t,n));return o}function y(e){var t="a, button, select, input, textarea, summary, *[onclick], *[contenteditable=true], *.jfk-button, *.goog-flat-menu-button, *[role=button], *[role=link], *[role=menuitem], *[role=option], *[role=switch], *[role=tab], *[role=checkbox], *[role=combobox], *[role=menuitemcheckbox], *[role=menuitemradio]";return d.conf.clickableSelector.length&&(t+=", "+d.conf.clickableSelector),e.matches(t)||"pointer"===getComputedStyle(e).cursor||"url("===getComputedStyle(e).cursor.substr(0,4)||null!==e.closest("a, *[onclick], *[contenteditable=true], *.jfk-button, *.goog-flat-menu-button")}function v(e,t){a("showBanner",[e,t])}function w(e){a("showPopup",[e])}function b(e,t,n){t.forEach((function(t){var o=new MouseEvent(t,{bubbles:!0,cancelable:!0,view:window,button:n?1:0});e.dispatchEvent(o)}))}function k(e){for(var t=e?e.target:document.activeElement;t&&t.shadowRoot;){if(!t.shadowRoot.activeElement){if(t.shadowRoot.querySelector("input, textarea, select")){t=t.shadowRoot.querySelector("input, textarea, select");break}break}t=t.shadowRoot.activeElement}return t===window&&(t=document.body),t}function E(){var e=k(),t=e.value;t.match(/^"|"$/)?e.value=t.replace(/^"?(.*?)"?$/,"$1"):e.value='"'+t+'"'}function S(e,t){chrome.storage.local.get(["logLevels"],(n=>{const o=n&&n.logLevels||["error"];-1!==["log","warn","error"].indexOf(e)&&-1!==o.indexOf(e)&&console[e](t)}))}function x(e){return e&&!e.disabled&&("textarea"===e.localName||"select"===e.localName||e.isContentEditable||e.matches&&e.matches(d.conf.editableSelector)||"input"===e.localName&&/^(?!button|checkbox|file|hidden|image|radio|reset|submit)/i.test(e.type))}function C(e,t){e=encodeURIComponent(e),t="%23%23+Error+details%0A%0A{0}%0A%0ASurfingKeys%3A+{1}%0A%0AChrome%3A+{2}%0A%0AURL%3A+{3}%0A%0A%23%23+Context%0A%0A%2A%2APlease+replace+this+with+a+description+of+how+you+were+using+SurfingKeys.%2A%2A".format(encodeURIComponent(t),chrome.runtime.getManifest().version,encodeURIComponent(navigator.userAgent),encodeURIComponent(window.location.href)),w('<h2>Uh-oh! The SurfingKeys extension encountered a bug.</h2> <p>Please click <a href="https://github.com/brookhong/Surfingkeys/issues/new?title={0}&body={1}" target=_blank>here</a> to start filing a new issue, append a description of how you were using SurfingKeys before this message appeared, then submit it.  Thanks for your help!</p>'.format(e,t))}function T(e,t){e.scrollIntoViewIfNeeded?e.scrollIntoViewIfNeeded():N(e,t)||e.scrollIntoView()}function O(e,t){var n=x(e)?1:4;return(t=t||e.getBoundingClientRect()).width>n&&t.height>n}function N(e,t){var n=e.getBoundingClientRect(),o=window.innerHeight||document.documentElement.clientHeight,r=window.innerWidth||document.documentElement.clientWidth;return(t||O(e,n))&&n.top<o&&n.bottom>0&&n.left<r&&n.right>0}function L(e){for(var t=Array.from(document.documentElement.getElementsByTagName("*")),n=[],o=0;o<t.length;o++){var r=t[o];if(r.shadowRoot)for(var i=r.shadowRoot.querySelectorAll("*"),a=0;a<i.length;a++)t.push(i[a]);var s=r.getBoundingClientRect();s.top<=window.innerHeight&&s.bottom>=0&&s.left<=window.innerWidth&&s.right>=0&&s.height>0&&"hidden"!==getComputedStyle(r).visibility&&e(r,n)}return n}function _(e){var t=document.getSelection(),n=[t.type,t.anchorNode,t.anchorOffset,t.focusNode,t.focusOffset],o=document.scrollingElement.scrollTop;e(t),document.scrollingElement.scrollTop=o,"None"===n[0]?t.empty():"Caret"===n[0]?t.setPosition(n[3],n[4]):"Range"===n[0]&&(t.setPosition(n[1],n[2]),t.extend(n[3],n[4]))}function A(e){if(0===e.length)return e;var t=[];return e.forEach((function(e,n){if(R(e))t.push(e);else{for(var o=0;o<t.length;o++){if(t[o].contains(e))return void("A"===t[o].tagName&&t[o].href||(t[o]=e));if(t[o].shadowRoot&&t[o].shadowRoot.contains(e))return;if(e.contains(t[o]))return void console.log("skip: ",e,t[o])}t.push(e)}})),t}function M(e){var t;return 0===e.childElementCount?3===(t=e.getClientRects()).length?t[1]:2===t.length?t[0]:e.getBoundingClientRect():1===e.childElementCount&&e.firstElementChild.textContent?(((t=e.firstElementChild.getBoundingClientRect()).width<4||t.height<4)&&(t=e.getBoundingClientRect()),t):e.getBoundingClientRect()}function R(e){return d.conf.clickableSelector&&e.matches(d.conf.clickableSelector)}function I(e){return A(e=e.filter((function(e){var t=M(e);if(e.disabled||e.readOnly||!O(e,t))return!1;if(e.matches("input, textarea, select, form")||"true"===e.contentEditable||R(e))return!0;var n=e.getRootNode().elementFromPoint(t.left+t.width/2,t.top+t.height/2);return!n||n.shadowRoot&&(0===n.childElementCount||n.shadowRoot.contains(e))||n.contains(e)||e.contains(n)})))}function P(e,t){return I(g(document.body,NodeFilter.SHOW_ELEMENT,(function(n){return n.offsetHeight&&n.offsetWidth&&"pointer"===getComputedStyle(n).cursor&&(n.matches(e)||t&&(t.test(n.textContent)||t.test(n.getAttribute("aria-label"))))})))}function U(e,t,n){var o=["script","style","noscript","surfingkeys_mark"],r=document.createTreeWalker(e,NodeFilter.SHOW_TEXT,{acceptNode:function(e){if(!e.data.trim()||!e.parentNode.offsetParent||-1!==o.indexOf(e.parentNode.localName.toLowerCase())||!t.test(e.data))return t.lastIndex=0,NodeFilter.FILTER_REJECT;var n=e.parentNode.getBoundingClientRect();return n.width<4||n.height<4?NodeFilter.FILTER_REJECT:NodeFilter.FILTER_ACCEPT}},!1),i=[];if(1===n)i.push(r.firstChild());else if(-1===n)i.push(r.lastChild());else{if(0===n)return r;if(2===n)for(;r.nextNode();)i.push(r.currentNode.parentNode);else for(;r.nextNode();)i.push(r.currentNode)}return i}function F(e,t,n){var o=document.getSelection();o.setBaseAndExtent(e,t,e,n?t+n:e.data.length);var r=o.getRangeAt(0).getClientRects()[0],i={left:-1,top:-1};return r&&r.height>0&&r.width>0&&(i.left=r.left,i.top=r.top,i.width=r.width,i.height=r.height),i}var D=document.createRange();function H(){let e=[];try{let t=arguments[1];for(;0===e.length&&t>=0;)D.setStart(arguments[0],t),arguments.length>3?D.setEnd(arguments[2],arguments[3]):arguments.length>2?D.setEnd(arguments[0],arguments[2]):D.setEnd(arguments[0],arguments[1]),e=D.getClientRects(),t--}catch(e){return[]}return e}var B=null;function K(e){var t=document.getSelection();if(t.focusNode&&t.focusNode.textContent){var n=function(e,t){var n=[0,e.length],o=/\W/;t<0?t=0:t>=e.length&&(t=e.length-1);var r=!0;if(o.test(e[t])){var i=0;for(r=!1;!r&&(t>i||t+i<e.length);)r=t-++i>=0&&!o.test(e[t-i])||t+i<e.length&&!o.test(e[t+i]);t=t-i>=0&&!o.test(e[t-i])?t-i:t+i}if(r){for(var a=t,s=t;a>=0&&!o.test(e[a]);)a--;for(;s<e.length&&!o.test(e[s]);)s++;n=[a+1,s-a-1]}return n}(t.focusNode.textContent,t.focusOffset),o=H(t.focusNode,n[0],n[0]+n[1])[0],r=t.focusNode.textContent.substr(n[0],n[1]);if(o&&r&&(!e||B&&o.has(B[0],B[1],0,0)))return r.trim()}return null}function q(e){var t=d.conf.language||window.navigator.language;"en-US"===t?e((function(e){return e})):fetch(chrome.extension.getURL("pages/l10n.json")).then((function(e){return e.json()})).then((function(n){"object"==typeof n[t]?(n=n[t],e((function(e){return n[e]?n[e]:e}))):e((function(e){return e}))}))}function j(e){var t=e.annotation.match(/#(\d+)(.*)/);return null!==t&&(e.feature_group=parseInt(t[1]),e.annotation=t[2]),e}function W(e,t,n,o){n=i.encodeKeystroke(n);var r=e.mappings.find(n);if(r){t=i.encodeKeystroke(t),e.mappings.remove(t);var s=Object.assign({},r.meta);o&&(s=Object.assign(s,j({annotation:o}))),e.mappings.add(t,s),p()||a("addMapkey",[e.name,t,n])}return r}function z(e){return e.getWords().map((function(t){var n=e.find(t).meta;return{word:t,feature_group:n.feature_group,annotation:n.annotation}})).filter((function(e){return e.annotation&&e.annotation.length>0}))}function V(e,t){var n;t=t||5,(n=(n="Array"===e.constructor.name?e:e instanceof NodeList?Array.from(e).map((function(e){return e.href})):e.trim().split("\n")).map((function(e){return e.trim()})).filter((function(e){return e.length>0}))).slice(0,t).forEach((function(e){s("openLink",{tab:{tabbed:!0},url:e})})),n.length>t&&s("queueURLs",{urls:n.slice(t)})}function G(e){return e.filter((function(e){return e.offsetHeight&&e.offsetWidth&&!e.getAttribute("disabled")&&N(e)&&"hidden"!==getComputedStyle(e).visibility}))}function Q(t,n){t.innerHTML=e.sanitize(n)}function $(e,t,n){var o=document.createElement(e);if(t&&Q(o,t),n)for(var r in n)o.setAttribute(r,n[r]);return o}document.addEventListener("mousedown",(e=>{B=[e.clientX,e.clientY]})),DOMRect.prototype.has=function(e,t,n,o){return t>this.top-o&&t<this.bottom+o&&e>this.left-n&&e<this.right+n},String.prototype.format=function(){for(var e=this,t=0;t<arguments.length;t++){var n=new RegExp("\\{"+t+"\\}","gi");e=e.replace(n,arguments[t])}return e},String.prototype.reverse=function(){return this.split("").reverse().join("")},RegExp.prototype.toJSON=function(){return{source:this.source,flags:this.flags}},Array.prototype.flatMap||(Array.prototype.flatMap=function(e){return Array.prototype.concat.apply([],this.map(e))});var Y=document.createElement("div");function J(e){return Y.innerText=e,Y.innerHTML}function X(e,t){var n=document.createElement("script");n.type="text/javascript","function"==typeof e?(Q(n,"("+e.toString()+")(window);"),setTimeout((function(){t&&t(),n.remove()}),1)):(n.src=e,n.onload=function(){t&&t(),n.remove()}),document.lastElementChild.appendChild(n)}HTMLElement.prototype.one=function(e,t){this.addEventListener(e,(function n(){t.call(this),this.removeEventListener(e,n)}))},HTMLElement.prototype.show=function(){this.style.display=""},HTMLElement.prototype.hide=function(){this.style.display="none"},HTMLElement.prototype.removeAttributes=function(){for(;this.attributes.length>0;)this.removeAttribute(this.attributes[0].name)},HTMLElement.prototype.containsWithShadow=function(e){const t=[this];for(;t.length;){const n=t.shift();if(n.contains(e))return!0;if(t.push(...n.children),n.shadowRoot){if(n.shadowRoot.contains(e))return!0;t.push(...n.shadowRoot.children)}}return!1},NodeList.prototype.remove=function(){this.forEach((function(e){e.remove()}))},NodeList.prototype.show=function(){this.forEach((function(e){e.show()}))},NodeList.prototype.hide=function(){this.forEach((function(e){e.hide()}))};const Z=$("div","",{style:"position: fixed; box-shadow: 0px 0px 4px 2px #63b2ff; background: transparent; z-index: 2140000000"});function ee(e,t){var n=M(e);Z.style.left=n.left+"px",Z.style.top=n.top+"px",Z.style.width=n.width+"px",Z.style.height=n.height+"px",document.body.appendChild(Z),setTimeout((()=>{Z.remove(),t()}),100)}function te(e,t){const n={candidates:0};if(t.length>0)for(const o of e){const e=o.label;if(t===e){n.matched=o.link;break}0===e.indexOf(t)?(o.style.opacity=1,Q(o,`<span style="opacity: 0.2;">${t}</span>`+e.substr(t.length)),n.candidates++):o.style.opacity=0}else if(1===e.length)n.matched=e[0].link;else{for(const t of e)t.style.opacity=1,Q(t,t.label);n.candidates=e.length}return n}var ne=[];const oe=function(e,t){this.name=e,this.statusLine=t,this.eventListeners={},this.addEventListener=function(e,t){return this.eventListeners[e]=t,le.hasOwnProperty(e)||(le[e]=function(t){ae(e,t)},window.addEventListener(e,le[e],!0)),this},this.enter=function(e,t){var n=ne.indexOf(this);if(this.priority||(this.priority=e||ne.length),-1===n)ne.unshift(this);else if(n>0)if(t)ne=ne.slice(n);else{var o=ne.map((function(e){return e.name})).join(",");C("Mode {0} pushed into mode stack again.".format(this.name),"Modes in stack: {0}".format(o))}return ne.sort((function(e,t){return e.priority<t.priority?1:t.priority<e.priority?-1:0})),this.onEnter&&this.onEnter(),oe.showStatus(),n},this.exit=function(e){var t=ne.indexOf(this);if(-1!==t)if(this.priority=0,e)ne.splice(t,1);else{t++;ne.slice(0,t);ne=ne.slice(t)}oe.showStatus(),this.onExit&&this.onExit(t)}};oe.getCurrent=()=>ne[0],oe.specialKeys={"<Alt-s>":["<Alt-s>"],"<Esc>":["<Esc>"]},oe.isSpecialKeyOf=function(e,t){return-1!==oe.specialKeys[e].indexOf(i.decodeKeystroke(t))};var re=[];function ie(e,t){t.sk_stopPropagation&&(t.stopImmediatePropagation(),t.preventDefault())}function ae(e,t,n){for(var o=0;o<ne.length&&!t.sk_stopPropagation;o++){var r=ne[o];if(!t.sk_suppressed&&r.eventListeners.hasOwnProperty(e))(0,r.eventListeners[e])(t),ie(0,t);if("Disabled"===r.name)break;n&&n(r)}}oe.suppressKeyUp=function(e){-1===re.indexOf(e)&&re.push(e)};let se=0;var ce=0,le={sentinel:e=>{se++},keydown:function(e){if(e.sk_keyName=i.getKeyChar(e),0===ne.length&&window!==top)return a("iframeBoot"),void document.addEventListener("surfingkeys:userSettingsLoaded",(()=>{ae("keydown",e)}),{once:!0});ae("keydown",e)},keyup:function(e){ae("keyup",e,(function(t){var n=re.indexOf(e.keyCode);-1!==n&&(e.stopImmediatePropagation(),re.splice(n,1))}))},scroll:function(e){ce>0&&(e.stopImmediatePropagation(),e.preventDefault(),ce--)}};function ue(e){for(var t in ne=[],le)window.addEventListener(t,le[t],!0);e&&e()}oe.hasScroll=function(e,t,n){var o="y"===t?["scrollTop","height"]:["scrollLeft","width"],r=e[o[0]];if(r<n){var i=e[o[0]];e[o[0]]=e.getBoundingClientRect()[o[1]],(r=e[o[0]])!==i&&ce++,e[o[0]]=i}return r>=n},oe.getScrollableElements=function(){var e=g(document.body,NodeFilter.SHOW_ELEMENT,(function(e){return oe.hasScroll(e,"y",16)&&e.scrollHeight>200||oe.hasScroll(e,"x",16)&&e.scrollWidth>200}));return e.sort((function(e,t){return t.contains(e)?1:e.contains(t)?-1:t.scrollHeight*t.scrollWidth-e.scrollHeight*e.scrollWidth})),document.scrollingElement&&(document.scrollingElement.scrollHeight>window.innerHeight||document.scrollingElement.scrollWidth>window.innerWidth)&&e.unshift(document.scrollingElement),e},oe.init=e=>{"about:blank"!==window.location.href||!window.frameElement||document.body&&0!==document.body.childElementCount?ue(e):window.frameElement.addEventListener("load",(function(t){try{ue(e)}catch(e){console.log("Error on blank iframe loaded: "+e)}}))},oe.showStatus=function(){if(document.hasFocus()&&ne.length){var e=ne[0],t=e.statusLine||(d.conf.showModeStatus?e.name:"");if(""!==t&&window!==top&&!p()){var n=window.location.pathname.split("/");n.length&&(t+=" - frame: "+n[n.length-1])}a("showStatus",[[t]])}},oe.finish=function(e){var t=!1;return(e.map_node!==e.mappings||null!=e.pendingMap||e.repeats)&&(e.map_node=e.mappings,e.pendingMap=null,e.isTrustedEvent&&a("hideKeystroke"),e.repeats&&(e.repeats=""),t=!0),t},oe.handleMapKey=function(e,t){var n=e.sk_keyName;this.isTrustedEvent=this.__trust_all_events__||e.isTrusted;var o=oe.isSpecialKeyOf("<Esc>",n);o&&(n=i.encodeKeystroke("<Esc>"));var r=!1;if(o&&oe.finish(this))e.sk_stopPropagation=!0,e.sk_suppressed=!0,r=!0;else if(this.pendingMap){this.setLastKeys&&this.setLastKeys(this.map_node.meta.word+n);var c=this.pendingMap.bind(this);e.sk_stopPropagation=!this.map_node.meta.stopPropagation||this.map_node.meta.stopPropagation(n),c(n),r=oe.finish(this)}else if(void 0!==this.repeats&&this.map_node===this.mappings&&d.conf.digitForRepeat&&(n>="1"||""!==this.repeats&&n>="0")&&n<="9"&&this.map_node.getWords().length>0)this.repeats+=n,this.isTrustedEvent&&a("showKeystroke",[n,this]),e.sk_stopPropagation=!0;else{var l=this.map_node;if(this.map_node=this.map_node.find(n),this.map_node)if(this.map_node.meta){var u=this.map_node.meta.code;if(u.length)this.pendingMap=u,this.isTrustedEvent&&a("showKeystroke",[n,this]),e.sk_stopPropagation=!0;else{for(this.setLastKeys&&this.setLastKeys(this.map_node.meta.word),s.repeats=parseInt(this.repeats)||1,e.sk_stopPropagation=!this.map_node.meta.stopPropagation||this.map_node.meta.stopPropagation(n);s.repeats>0;)u(),s.repeats--;r=oe.finish(this)}}else this.isTrustedEvent&&a("showKeystroke",[n,this]),e.sk_stopPropagation=!0;else t&&t(l),e.sk_suppressed=l!==this.mappings,r=oe.finish(this)}return r},oe.checkEventListener=e=>{const t=se;window.dispatchEvent(new CustomEvent("sentinel")),t===se&&(ue(),e())};const de=oe;function fe(){arguments.length>0&&(this.stem=arguments[0]),arguments.length>1&&(this.meta=arguments[1])}fe.prototype={find:function(e){for(var t=this,n=e.length,o=0;o<n&&t;o++)t=t[e[o]];return t},add:function(e,t){for(var n=this,o=e.length,r=0;r<o;r++){var i=e[r];if(n.hasOwnProperty(i))n=n[i];else{var a=new fe(i);n[i]=a,n=a}}t.word=e,n.meta=t},remove:function(e){for(var t=this,n=e.length,o=[],r=0;r<n&&t;r++)o.push(t),t=t[e[r]];if(t){var i=o[r=o.length-1];delete i[t.stem];for(var a=i;a!==this&&1===Object.keys(a).length;)delete(i=o[--r])[a.stem],a=i}return t},getWords:function(e,t){var n=[];e=(e||"")+(t?"":this.stem||"");for(var o in this.hasOwnProperty("meta")&&n.push(e),this)1===o.length&&(n=n.concat(this[o].getWords(e)));return n},getMetas:function(e){var t=[];for(var n in this.hasOwnProperty("meta")&&e(this.meta)&&t.push(this.meta),this)1===n.length&&(t=t.concat(this[n].getMetas(e)));return t},getPrefixWord:function(){if(0===Object.keys(this).length)return"";for(var e="",t=this.stem,n=this;""===e;)for(var o=Object.keys(n),r=0;r<o.length;r++){if("meta"===o[r]){e=n.meta.word;break}if("stem"!==o[r]){t+=o[r],n=n[o[r]];break}}return e.substr(0,e.length-t.length+1)}};const pe=fe;const me=function(e){var t=new de("Normal");t.mappings=new pe,t.map_node=t.mappings;var n=!1;let o;t.passFocus=function(e){n=e},t.startLurk=()=>{let e="lurking";return o?de.getCurrent()!==o&&(e="enabled"):(t.exit(),o=function(e){const t=new de("Lurk");function n(){e.enter(),window===top&&s("setSurfingkeysIcon",{status:"enabled"})}return t.mappings=new pe,t.map_node=t.mappings,t.mappings.add(i.encodeKeystroke("<Alt-i>"),{annotation:"Enter normal mode",feature_group:16,code:n}),t.mappings.add("p",{annotation:"Enter ephemeral normal mode to temporarily enable SurfingKeys",feature_group:16,code:function(){n(),setTimeout((()=>{e.revertToLurk()}),1e3)}}),t.addEventListener("keydown",(function(e){!x(k(e))&&e.sk_keyName.length&&(de.handleMapKey.call(t,e),e.sk_stopPropagation&&de.suppressKeyUp(e.keyCode))})),t}(t),r.forEach((e=>{W(o,e[0],e[1]),o.mappings.remove(i.encodeKeystroke(e[1]))})),r=void 0,o.enter(0,!0)),e},t.revertToLurk=()=>{t.exit(!0),window===top&&s("setSurfingkeysIcon",{status:"lurking"})},t.getLurkMode=()=>o;let r=[];t.addLurkMap=(e,t)=>{r.push([e,t])};var c=!1;t.addEventListener("keydown",(function(n){var r=k(n);if(x(r)&&n.isTrusted)if(de.isSpecialKeyOf("<Esc>",n.sk_keyName))r.blur(),e.exit();else if(d.conf.editableBodyCare&&r===document.body&&"i"!==n.key)t.statusLine="Press i to enter Insert mode",d.conf.showModeStatus=!0,n.sk_keyName.length&&de.handleMapKey.call(t,n);else{n.sk_stopPropagation=d.conf.editableBodyCare&&r===document.body&&"i"===n.key,n.sk_stopPropagation&&(t.passFocus(!0),r.focus());var i=!1;if(!N(r)){for(var a=r;a!==document.documentElement&&!a.newlyCreated;)a=a.parentElement;i=a!==document.documentElement&&a.newlyCreated}i?(r.blur(),delete a.newlyCreated,de.handleMapKey.call(t,n)):e.enter(r,!0)}else if(de.isSpecialKeyOf("<Alt-s>",n.sk_keyName))t.toggleBlocklist(),de.finish(t),n.sk_stopPropagation=!0;else if(n.sk_keyName.length){var s=de.handleMapKey.call(t,n,(()=>{de.isSpecialKeyOf("<Esc>",n.sk_keyName)&&o&&t.revertToLurk()}));c&&s&&(c=!1,t.exit())}n.sk_stopPropagation&&de.suppressKeyUp(n.keyCode)})),t.addEventListener("blur",(function(e){m=0})),t.addEventListener("focus",(function(e){if(de.showStatus(),d.conf.stealFocusOnLoad&&!p()){var t=k(e);x(t)&&(n||t.enableAutoFocus?d.conf.enableAutoFocus||(n=!1):(t.blur(),e.sk_stopPropagation=!0))}})),t.addEventListener("keyup",(function(e){setTimeout((function(){m=0}),0)})),t.addEventListener("mousedown",(function(n){d.conf.enableAutoFocus?t.passFocus(!0):t.passFocus(n.isTrusted);var o=k(n);x(o)?e.enter(o,!0):e.exit()})),t.toggleBlocklist=function(){0!==document.location.href.indexOf(chrome.extension.getURL("/"))?s("toggleBlocklist",{blocklistPattern:d.conf.blocklistPattern?d.conf.blocklistPattern.toJSON():""},(function(e){"disabled"===e.state?e.blocklist.hasOwnProperty(".*")?v("Surfingkeys is globally disabled, please enable it globally from popup menu.",3e3):v("Surfingkeys turned OFF for "+e.url,3e3):v("Surfingkeys turned ON for "+e.url,3e3)})):v("You could not toggle Surfingkeys on its own pages.",3e3)};const l=function(){var e,t,n=new de("PassThrough");return n.addEventListener("keydown",(function(o){o.sk_suppressed=!0,de.isSpecialKeyOf("<Esc>",o.sk_keyName)?(n.exit(),o.sk_stopPropagation=!0):t>0&&(e&&(clearTimeout(e),e=void 0),e=setTimeout((function(){n.exit()}),t))})).addEventListener("mousedown",(function(e){e.sk_suppressed=!0})),n.addEventListener("focus",(function(e){e.sk_suppressed=!0})),n.onEnter=function(){t>0?(e=setTimeout((function(){n.exit()}),t),n.statusLine=`ephemeral(${t}ms) pass through`):n.statusLine="pass through"},n.setTimeout=function(e){t=e},n}();t.passThrough=function(e){return l.setTimeout(e),l.enter(),l},t.once=()=>{c=!0,t.enter()},t.mappings.add(i.encodeKeystroke("<Alt-i>"),{annotation:"Enter PassThrough mode to temporarily suppress SurfingKeys",feature_group:0,code:function(){t.passThrough()}}),t.mappings.add("p",{annotation:"Enter ephemeral PassThrough mode to temporarily suppress SurfingKeys",feature_group:0,code:function(){t.passThrough(1e3)}}),t.repeats="";var u,f,m=0,h=0,g=[];function b(){u&&0!==u.length||((u=de.getScrollableElements()).forEach((function(e){e.removeEventListener("mousedown",E),e.addEventListener("mousedown",E),e.dataset.hint_scrollable=!0})),h=0)}function E(e){if(e.currentTarget.contains(e.target)){for(var t=u.lastIndexOf(e.target),n=u.length-1;n>=0&&-1===t;n--)u[n]!==document.body&&u[n].contains(e.target)&&(t=n);-1!==t&&(h=t)}}function S(){s("localData",{data:{lastKeys:f}})}t.highlightElement=function(e){var t;a("highlightElement",{duration:200,rect:{top:(t=document.scrollingElement===e?{top:0,left:0,width:window.innerWidth,height:window.innerHeight}:e.getBoundingClientRect()).top,left:t.left,width:t.width,height:t.height}})},t.scroll=function(e){b();var n=document.scrollingElement;if(u.length>0&&(n=u[h])!==document.scrollingElement&&n!==document.body){var o=n.getBoundingClientRect();0!==o.width&&0!==o.height&&N(n)&&(de.hasScroll(n,"x",16)||de.hasScroll(n,"y",16))||(t.refreshScrollableElements(),n=u[h])}if(n||document.scrollingElement||!document.body||(document.body.style.overflow="visible",n=document.scrollingElement),n){var r;n.skScrollBy||((r=n).skScrollBy=function(e,t){if(d.conf.smartPageBoundary&&(this===document.scrollingElement||1===u.length&&this===u[0])){if(0===this.scrollTop&&t<0)return a("topBoundaryHit");if(this.scrollHeight-this.scrollTop<=this.clientHeight+1&&t>0)return a("bottomBoundaryHit")}if(s.repeats>1&&(e=s.repeats*e,t=s.repeats*t,s.repeats=0),d.conf.smoothScroll){var n=Math.max(100,20*Math.log(Math.abs(e||t)));r.smoothScrollBy(e,t,n)}else a("scrollStarted"),r.scrollBy({behavior:"instant",left:e,top:t}),a("scrollDone")},r.safeScroll_=(e,t,n)=>{const o=r===document.scrollingElement?window.innerHeight:r.clientHeight,i=r===document.scrollingElement?window.innerWidth:r.clientWidth,a="scrollTop"===e?[0,r.scrollHeight-o]:[0,r.scrollWidth-i],s=n?a[1]:a[0];return t>=a[0]&&t<=a[1]?(r[e]=t,!1):(r[e]=s,!0)},r.smoothScrollBy=function(e,t,n){if(!m){var[o,i]=t?["scrollTop",t]:["scrollLeft",e],s=n,c=0,l=r[o],u=!1;function f(e){if(0===c)return c=e,a("scrollStarted"),window.requestAnimationFrame(f);var t=r[o],n=(e-c)*i/s;let p=!1;Math.abs(t+n-l)>=Math.abs(i)?(u=!0,m>d.conf.scrollFriction?(p=r.safeScroll_(o,t+n,i>0),l=r[o]):m>0?m++:p=r.safeScroll_(o,l+i,i>0)):p=r.safeScroll_(o,t+n,i>0),c=e,m||!p&&!u?window.requestAnimationFrame(f):(r.style.scrollBehavior="",a("scrollDone"))}m=1,r.style.scrollBehavior="auto",window.requestAnimationFrame(f)}},g.push(r));var i=n===document.scrollingElement?[window.innerWidth,window.innerHeight]:[n.offsetWidth,n.offsetHeight];switch(n.lastScrollTop=n.scrollTop,n.lastScrollLeft=n.scrollLeft,e){case"down":n.skScrollBy(0,d.conf.scrollStepSize);break;case"up":n.skScrollBy(0,-d.conf.scrollStepSize);break;case"pageDown":n.skScrollBy(0,Math.round(i[1]/2));break;case"fullPageDown":n.skScrollBy(0,i[1]);break;case"pageUp":n.skScrollBy(0,-Math.round(i[1]/2));break;case"fullPageUp":n.skScrollBy(0,-i[1]);break;case"top":n.skScrollBy(0,-n.scrollTop);break;case"bottom":n.skScrollBy(n.scrollLeft,n.scrollHeight-n.scrollTop);break;case"left":n.skScrollBy(-Math.round(d.conf.scrollStepSize/2),0);break;case"right":n.skScrollBy(Math.round(d.conf.scrollStepSize/2),0);break;case"leftmost":n.skScrollBy(-n.scrollLeft-10,0);break;case"rightmost":n.skScrollBy(n.scrollWidth-n.scrollLeft-i[0]+20,0);break;case"byRatio":var c=parseInt(s.repeats*n.scrollHeight/100)-i[1]/2-n.scrollTop;s.repeats=0,n.skScrollBy(0,c)}a("turnOffDOMObserver")}},t.refreshScrollableElements=function(){return u=null,b(),u},t.addScrollableElement=function(e){u&&(e.contains(u[h])||-1!==u.indexOf(e))||(b(),u.push(e),h=u.length-1)},t.rotateFrame=function(){s("nextFrame",{frameId:window.frameId})},t.feedkeys=function(e){setTimeout((function(){for(var n=new Event("keydown"),o=0;o<e.length;o++)n.sk_keyName=e[o],de.handleMapKey.call(t,n)}),1)},t.setLastKeys=function(e){!this.map_node.meta.repeatIgnore&&e.length>1&&(f=[e],S())},t.appendKeysForRepeat=function(e,t){f&&f.length>0&&(f.push("{0}\t{1}".format(e,t)),S())},t.addVIMark=function(e,t){t=t||window.location.href;var n={};n[e]={url:t,scrollLeft:document.scrollingElement.scrollLeft,scrollTop:document.scrollingElement.scrollTop},s("addVIMark",{mark:n}),v("Mark '{0}' added for: {1}.".format(e,t))},t.jumpVIMark=function(e){if("'"===e){let e=document.scrollingElement;if(b(),u.length>0&&(e=u[h],void 0!==e.lastScrollTop&&void 0!==e.lastScrollLeft)){const t=e.scrollTop,n=e.scrollLeft;e.scrollTop=e.lastScrollTop,e.scrollLeft=e.lastScrollLeft,e.lastScrollTop=t,e.lastScrollLeft=n}}else s("jumpVIMark",{mark:e})},t.moveTab=function(e){s("moveTab",{position:e})},t.captureElement=function(e){s("getCaptureSize",null,(function(t){var n=t.width/window.innerWidth;e.scrollTop=0,e.scrollLeft=0;var o=-1,r=-1,i=e.style.overflowY;e.style.overflowY="hidden";var c=e.style.overflowX;e.style.overflowX="hidden";var l=e.style.borderStyle;e.style.borderStyle="none",a("toggleStatus",[!1]);var u,d,f,p,m,h,g=0,y=0,v=e.scrollHeight,b=e.scrollWidth;if(e===document.scrollingElement)m=window.innerWidth,h=window.innerHeight,u=0,d=0;else{var k=e.getBoundingClientRect(),E=[Math.max(k.left,0),Math.max(k.top,0),Math.min(k.right,window.innerWidth),Math.min(k.bottom,window.innerHeight)];m=E[2]-E[0],h=E[3]-E[1],u=E[0]*n,d=E[1]*n}f=m*n,p=h*n;var S=document.createElement("canvas");S.width=b*n,S.height=v*n;var x=S.getContext("2d"),C=(k=e.getBoundingClientRect(),document.createElement("img"));C.onload=function(){x.drawImage(C,u,d,f,p,g,y,f,p),o===e.scrollTop?r===e.scrollLeft?(a("toggleStatus",[!0]),w("<img src='{0}' />".format(S.toDataURL("image/png"))),e.style.overflowY=i,e.style.overflowX=c,e.style.borderStyle=l):(o=-1,e.scrollTop=0,y=0,r=e.scrollLeft,e.scrollLeft+2*m<b?(e.scrollLeft+=m,g+=m*n):(e.scrollLeft+=b%m,g=e.scrollLeft*n),setTimeout((function(){s("captureVisibleTab",null,(function(e){C.src=e.dataUrl}))}),1e3)):(o=e.scrollTop,e.scrollTop+2*h<v?(e.scrollTop+=h,y+=h*n):(e.scrollTop+=v%h,y=e.scrollTop*n),setTimeout((function(){s("captureVisibleTab",null,(function(e){C.src=e.dataUrl}))}),1e3))},setTimeout((function(){s("captureVisibleTab",null,(function(e){C.src=e.dataUrl}))}),500)}))},t.mappings.add("yG",{annotation:"Capture current full page",feature_group:7,code:function(){t.captureElement(document.scrollingElement)}}),t.mappings.add("yS",{annotation:"Capture scrolling element",feature_group:7,code:function(){var e=document.scrollingElement;b(),u.length>0&&(e=u[h]),t.captureElement(e)}}),t.mappings.add("cS",{annotation:"Reset scroll target",feature_group:2,code:function(){if(u=null,b(),u.length>0){var e=u[h];t.highlightElement(e)}}});const C=e=>{const n=t.scroll.bind(t,e);return n.isSKScrollInHints=!0,n};function O(e){-1===d.conf.mouseSelectToQuery.indexOf(window.origin)||y(e.target)||e.target.matches(".cm-matchhighlight")||setTimeout((()=>{a("querySelectedWord")}),1)}t.isScrollKeyInHints=e=>{const n=t.mappings[e];return n&&n.meta&&n.meta.code&&n.meta.code.isSKScrollInHints},t.mappings.add("e",{annotation:"Scroll half page up",feature_group:2,repeatIgnore:!0,code:t.scroll.bind(t,"pageUp")}),t.mappings.add("U",{annotation:"Scroll full page up",feature_group:2,repeatIgnore:!0,code:t.scroll.bind(t,"fullPageUp")}),t.mappings.add("d",{annotation:"Scroll half page down",feature_group:2,repeatIgnore:!0,code:t.scroll.bind(t,"pageDown")}),t.mappings.add("P",{annotation:"Scroll full page down",feature_group:2,repeatIgnore:!0,code:t.scroll.bind(t,"fullPageDown")}),t.mappings.add("gg",{annotation:"Scroll to the top of the page",feature_group:2,repeatIgnore:!0,code:t.scroll.bind(t,"top")}),t.mappings.add("G",{annotation:"Scroll to the bottom of the page",feature_group:2,repeatIgnore:!0,code:C("bottom")}),t.mappings.add("j",{annotation:"Scroll down",feature_group:2,repeatIgnore:!0,code:C("down")}),t.mappings.add("k",{annotation:"Scroll up",feature_group:2,repeatIgnore:!0,code:C("up")}),t.mappings.add("h",{annotation:"Scroll left",feature_group:2,repeatIgnore:!0,code:C("left")}),t.mappings.add("l",{annotation:"Scroll right",feature_group:2,repeatIgnore:!0,code:C("right")}),t.mappings.add("0",{annotation:"Scroll all the way to the left",feature_group:2,repeatIgnore:!0,code:C("leftmost")}),t.mappings.add("$",{annotation:"Scroll all the way to the right",feature_group:2,repeatIgnore:!0,code:C("rightmost")}),t.mappings.add("%",{annotation:"Scroll to percentage of current page",feature_group:2,repeatIgnore:!0,code:t.scroll.bind(t,"byRatio")}),t.mappings.add("cs",{annotation:"Change scroll target",feature_group:2,repeatIgnore:!0,code:function(){!function(e){if((u=de.getScrollableElements()).length>0){h=(h+1)%u.length;var n=u[h];T(n),e||t.highlightElement(n)}}()}}),t.mappings.add("/",{annotation:"Find in current page",feature_group:9,repeatIgnore:!0,code:function(){a("openFinder")}}),t.mappings.add("E",{annotation:"Go one tab left",feature_group:3,repeatIgnore:!0,code:function(){s("previousTab")}}),t.mappings.add("R",{annotation:"Go one tab right",feature_group:3,repeatIgnore:!0,code:function(){s("nextTab")}});var L=null;return t.disable=function(){L||(L=function(e){const t=new de("Disabled");return t.statusLine="",t.priority=99,t.addEventListener("keydown",(function(n){n.sk_suppressed=!0,de.isSpecialKeyOf("<Alt-s>",n.sk_keyName)&&(e.toggleBlocklist(),t.exit(),n.sk_stopPropagation=!0)})),t}(t),L.enter(0,!0)),a("turnOffDOMObserver"),document.removeEventListener("mouseup",O)},t.enable=function(){L&&(L.exit(),L=null),document.addEventListener("mouseup",O)},t.enable(),t.onExit=function(){a("turnOffDOMObserver"),g.forEach((function(e){delete e.skScrollBy,delete e.smoothScrollBy}))},t};const he=function(e){var t=void 0,n=new MutationObserver((function(n){var o=[];for(var r of n)for(var i of r.addedNodes)i.nodeType!==Node.ELEMENT_NODE||i.fromSurfingKeys||(i.newlyCreated=!0,o.push(i));o.length&&(t&&(clearTimeout(t),t=void 0),t=setTimeout((function(){var t=L((function(e,t){var n=e.getBoundingClientRect();n.width>300&&n.height>300&&n.width<=window.innerWidth&&n.height<=window.innerHeight&&n.top>=0&&n.left>=0&&de.hasScroll(e,"y",16)&&function(e){for(;e!==document.body;){if("relative"===getComputedStyle(e).position)return!0;e=e.parentElement}return!1}(e)&&t.push(e)}));t.length&&e.addScrollableElement(t[0])}),200))}));n.isConnected=!1,document.addEventListener("surfingkeys:turnOnDOMObserver",(function(e){n.isConnected||(n.observe(document,{childList:!0,subtree:!0}),n.isConnected=!0)})),document.addEventListener("surfingkeys:turnOffDOMObserver",(function(e){n.isConnected&&(n.disconnect(),n.isConnected=!1)}))};const ge=function(){var e=new de("Insert");function t(){var e=k();if(void 0!==e.setSelectionRange)try{e.setSelectionRange(e.value.length,e.value.length)}catch(e){if(!(e instanceof DOMException&&"InvalidStateError"===e.name))throw e}else if(x(e)&&e.childNodes.length>0){var t=e.childNodes[e.childNodes.length-1];if(t.nodeType===Node.TEXT_NODE)document.getSelection().setPosition(t,t.data.length);else{t.querySelector(".CodeMirror-line")?function(e){let t=document.createRange();t.selectNodeContents(e),t.collapse(!1);let n=window.getSelection();n.removeAllRanges(),n.addRange(t)}(e):document.getSelection().setPosition(t,t.childNodes.length)}Visual.showCursor(),Visual.hideCursor()}}e.mappings=new pe,e.map_node=e.mappings,e.mappings.add(i.encodeKeystroke("<Ctrl-e>"),{annotation:"Move the cursor to the end of the line",feature_group:15,code:t}),e.mappings.add(i.encodeKeystroke("<Ctrl-f>"),{annotation:"Move the cursor to the beginning of the line",feature_group:15,code:function(){var e=k();if(void 0!==e.setSelectionRange)e.setSelectionRange(0,0);else{var t=document.getSelection();t.setPosition(t.focusNode,0),Visual.showCursor(),Visual.hideCursor()}}}),e.mappings.add(i.encodeKeystroke("<Ctrl-u>"),{annotation:"Delete all entered characters before the cursor",feature_group:15,code:function(){var e=k();if(void 0!==e.setSelectionRange)e.value=e.value.substr(e.selectionStart),e.setSelectionRange(0,0);else{var t=document.getSelection();t.focusNode.data=t.focusNode.data.substr(t.focusOffset)}}}),e.mappings.add(i.encodeKeystroke("<Alt-b>"),{annotation:"Move the cursor Backward 1 word",feature_group:15,code:function(){var e=k();if(void 0!==e.setSelectionRange){var t=l(e.value,-1,e.selectionStart);e.setSelectionRange(t,t)}else document.getSelection().modify("move","backward","word")}}),e.mappings.add(i.encodeKeystroke("<Alt-f>"),{annotation:"Move the cursor Forward 1 word",feature_group:15,code:function(){var e=k();if(void 0!==e.setSelectionRange){var t=l(e.value,1,e.selectionStart);e.setSelectionRange(t,t)}else document.getSelection().modify("move","forward","word")}}),e.mappings.add(i.encodeKeystroke("<Alt-w>"),{annotation:"Delete a word backwards",feature_group:15,code:function(){var e=k();if(void 0!==e.setSelectionRange){var t=u(e.value,-1,e.selectionStart);e.value=t[0],e.setSelectionRange(t[1],t[1])}else{var n=document.getSelection(),o=n.focusOffset;document.getSelection().modify("move","backward","word");var r=n.focusNode.data,i=n.focusOffset;n.focusNode.data=r.substr(0,i)+r.substr(o),n.setPosition(n.focusNode,i)}}}),e.mappings.add(i.encodeKeystroke("<Alt-d>"),{annotation:"Delete a word forwards",feature_group:15,code:function(){var e=k();if(void 0!==e.setSelectionRange){var t=u(e.value,1,e.selectionStart);e.value=t[0],e.setSelectionRange(t[1],t[1])}else{var n=document.getSelection(),o=n.focusOffset;document.getSelection().modify("move","forward","word");var r=n.focusNode.data,i=n.focusOffset;n.focusNode.data=r.substr(0,o)+r.substr(i),n.setPosition(n.focusNode,o)}}}),e.mappings.add(i.encodeKeystroke("<Esc>"),{annotation:"Exit insert mode",feature_group:15,stopPropagation:function(e){return e.charCodeAt(0)<256},code:function(){k().blur(),e.exit()}});var n,o=$("div","",{id:"sk_emoji",style:"display: block; opacity: 1;"}),r=-1;function a(){var e=k(),t="",i=!0;if(void 0!==e.selectionStart&&void 0!==e.value)t=e.value.substr(r,e.selectionStart-r);else{i=!1;var a=document.getSelection();t=a.focusNode.data.substr(r,a.focusOffset-r)}if(t.length<d.conf.startToShowEmoji||" "===t[0])o.remove();else{var s=n.filter((function(e){return-1!==e.indexOf(t)})).slice(0,5).map((function(e){var t=e.split("\t"),n=String.fromCodePoint.apply(null,t[0].split(","));return"<div><span>{0}</span>{1}</div>".format(n,t[1])})).join("");if(""===s)o.remove();else{var c;Q(o,s),document.body.append(o),o.style.display="",o.querySelector("#sk_emoji>div").classList.add("selected"),i?c=function(e){var t=getComputedStyle(e),n=e.getBoundingClientRect(),o=document.createElement("div"),r=document.createElement("span");o.style.font=t.font,o.style.position="fixed",Q(o,e.value),o.style.left=e.clientLeft+n.left+"px",o.style.top=e.clientTop+n.top+"px",o.style.color="red",o.style.overflow="scroll",o.style.visibility="hidden",o.style.whiteSpace="pre-wrap",o.style.padding=t.padding,o.style.width=t.width,o.style.height=t.height,r.innerText="I";var i=e.selectionStart;if(i===e.value.length)o.appendChild(r);else{var a=o.childNodes[0].splitText(i);o.insertBefore(r,a)}return document.body.appendChild(o),T(r),n=r.getBoundingClientRect(),o.remove(),n}(e):(Visual.showCursor(),c=Visual.getCursorPixelPos(),Visual.hideCursor());var l=c.top+c.height+4;window.innerHeight-l<o.offsetHeight&&(l=c.top-o.offsetHeight),o.style.position="fixed",o.style.top=l+"px",o.style.left=c.left+"px"}}}document.addEventListener("surfingkeys:userSettingsLoaded",(function(t){d.conf.enableEmojiInsertion&&e.mappings.add(":",{annotation:"Input emoji",feature_group:15,stopPropagation:function(){return!1},code:function(){var e=k();r=void 0!==e.selectionStart?e.selectionStart+1:document.getSelection().focusOffset+1,fetch(chrome.extension.getURL("pages/emoji.tsv")).then((e=>Promise.all([e.text()]))).then((e=>{n=e[0].split("\n"),a()}))}})}));var s,c=!1;function l(e,t,n){var o=/\W/;for(n=t>0?n:n+t;;){if(n<0){n=0;break}if(n>=e.length){n=e.length;break}if(o.test(e[n]))break;n+=t}return n}function u(e,t,n){var o=l(e,t,n);return[o>n?e.substr(0,n)+e.substr(o):o<n?e.substr(0,o)+e.substr(n):e.substr(0,o)+e.substr(o+1),t>0?n:o]}e.addEventListener("keydown",(function(t){if(t.key&&t.key.charCodeAt(0)>127)t.sk_suppressed=!0;else{var n,a,s,l,u=k(t);if(o.offsetHeight>0){if(de.isSpecialKeyOf("<Esc>",t.sk_keyName))o.remove(),r=-1;else if(t.keyCode===i.keyCodes.tab||t.keyCode===i.keyCodes.upArrow||t.keyCode===i.keyCodes.downArrow)n=t.shiftKey||t.keyCode===i.keyCodes.upArrow,a=o.querySelector("#sk_emoji>div.selected"),s=Array.from(o.querySelectorAll("#sk_emoji>div")),l=(s.indexOf(a)+(n?-1:1))%s.length,a.classList.remove("selected"),s[l].classList.add("selected"),c=!0,t.sk_stopPropagation=!0;else if(t.keyCode===i.keyCodes.enter){var d=o.querySelector("#sk_emoji>div.selected>span").innerHTML;if(void 0!==u.setSelectionRange){var f=u.value;u.value=f.substr(0,r-1)+d+f.substr(u.selectionStart),u.setSelectionRange(r,r)}else{var p=document.getSelection();f=p.focusNode.data;p.focusNode.data=f.substr(0,r-1)+d+f.substr(p.focusOffset),p.setPosition(p.focusNode,r)}o.remove(),r=-1,t.sk_stopPropagation=!0}}else x(u)?t.sk_keyName.length&&de.handleMapKey.call(e,t,(function(e){var t=e.getPrefixWord();if(t){var n=k(),o=n.value,r=n.selectionStart;if(void 0!==o&&void 0!==r)n.value=o.substr(0,n.selectionStart)+t+o.substr(n.selectionEnd),r+=t.length,n.setSelectionRange(r,r);else{var i=(n=document.getSelection()).getRangeAt(0),a=document.createTextNode(t);"Caret"===n.type?void 0===(o=n.focusNode.data)?(i.insertNode(a),n.setPosition(a,a.length)):(r=n.focusOffset,n.focusNode.data=o.substr(0,r)+t+o.substr(r),n.setPosition(n.focusNode,r+t.length)):(i.deleteContents(),i.insertNode(a),n.setPosition(a,a.length))}}})):e.exit();t.sk_suppressed=!0}})),e.addEventListener("keyup",(function(e){var t=k(e);if(!c&&-1!==r){var n,i;if(void 0!==t.selectionStart&&void 0!==t.value)n=t.value,i=t.selectionStart;else{var s=document.getSelection();n=s.focusNode.data,i=s.focusOffset}i<r||":"!==n[r-1]?o.remove():a()}c=!1})),e.addEventListener("focus",(function(t){var n=k(t);t.target==window||x(n)?t.sk_suppressed=!0:e.exit()}));var f=e.enter;return e.enter=function(n,o){n===document.body&&(d.conf.showModeStatus=!1);var r=-1===f.call(e,0,!0);s!==n&&(s=n,r=!0),r&&!o&&d.conf.cursorAtEndOfInput&&"SELECT"!==n.nodeName&&t()},e};const ye=function(e,t){var n=new de("Visual");n.addEventListener("keydown",(function(e){if(k){var t=!1;e.sk_stopPropagation=!0,e.sk_suppressed=!0,i.isWordChar(e)?(S(k,e.sk_keyName),E=[k,e.sk_keyName],t=!0):de.isSpecialKeyOf("<Esc>",e.sk_keyName)&&(t=!0),t&&(n.statusLine=n.name+" - "+y[g],de.showStatus(),k=0)}else e.sk_keyName.length&&(de.handleMapKey.call(n,e),e.sk_stopPropagation?e.sk_suppressed=!0:de.isSpecialKeyOf("<Esc>",e.sk_keyName)&&(g>1?(n.hideCursor(),p.collapse(p.anchorNode,p.anchorOffset),n.showCursor()):(n.visualClear(),n.exit()),g--,P(),e.sk_stopPropagation=!0,e.sk_suppressed=!0))})),n.addEventListener("click",(function(e){switch(p.type){case"None":n.hideCursor(),g=0;break;case"Caret":g&&(n.hideCursor(),0===g&&(g=1),n.showCursor());break;case"Range":g&&(n.hideCursor(),g=2,n.showCursor())}P()})),n.addEventListener("resize",(function(e){d.conf.lastQuery&&n.visualUpdate(d.conf.lastQuery),m[h]&&x(m[h])}));let o=null;const r=()=>{o&&o.forEach((e=>{e.remove()}))};n.addEventListener("selectionchange",(function(e){var t,n,i,a;r(),t=p.anchorNode,n=p.anchorOffset,i=p.focusNode,a=p.focusOffset,o=N("surfingkeys_selection_mark",t,n,i,a)})),n.mappings=new pe,n.map_node=n.mappings,n.repeats="",n.mappings.add("l",{annotation:"forward character",feature_group:9,code:C}),n.mappings.add("h",{annotation:"backward character",feature_group:9,code:C}),n.mappings.add("j",{annotation:"forward line",feature_group:9,code:C}),n.mappings.add("k",{annotation:"backward line",feature_group:9,code:C}),n.mappings.add("w",{annotation:"forward word",feature_group:9,code:C}),n.mappings.add("e",{annotation:"forward word",feature_group:9,code:C}),n.mappings.add("b",{annotation:"backward word",feature_group:9,code:C}),n.mappings.add(")",{annotation:"forward sentence",feature_group:9,code:C}),n.mappings.add("(",{annotation:"backward sentence",feature_group:9,code:C}),n.mappings.add("}",{annotation:"forward paragraphboundary",feature_group:9,code:C}),n.mappings.add("{",{annotation:"backward paragraphboundary",feature_group:9,code:C}),n.mappings.add("0",{annotation:"backward lineboundary",feature_group:9,code:C}),n.mappings.add("$",{annotation:"forward lineboundary",feature_group:9,code:C}),n.mappings.add("G",{annotation:"forward documentboundary",feature_group:9,code:function(){document.scrollingElement.scrollTop=document.scrollingElement.scrollHeight,"Firefox"!==f()?C():(n.hideCursor(),p.setPosition(document.body.lastChild,0),n.showCursor()),m.length&&a("showStatus",[[void 0,void 0,(h=m.length-1)+1+" / "+m.length]])}}),n.mappings.add("gg",{annotation:"backward documentboundary",feature_group:9,code:function(){document.scrollingElement.scrollTop=0,h=0,m.length&&a("showStatus",[[void 0,void 0,h+1+" / "+m.length]]),"Firefox"!==f()?C():(n.hideCursor(),p.setPosition(document.body.firstChild,0),n.showCursor())}}),n.mappings.add("o",{annotation:"Go to Other end of highlighted text",feature_group:9,code:function(){n.hideCursor();var e=[p.anchorNode,p.anchorOffset];p.collapse(p.focusNode,p.focusOffset),p.extend(e[0],e[1]),n.showCursor()}});var s={w:"word",l:"lineboundary",s:"sentence",p:"paragraphboundary"};function c(e){if("Firefox"!==f()||"p"!==e&&"s"!==e){var t=s[e];p.modify("extend","forward",t)}}var l=[{},{annotation:"Yank a word(w) or line(l) or sentence(s) or paragraph(p)",feature_group:9,code:function(t){var o=[p.focusNode,p.focusOffset];n.hideCursor(),c(t),e.write(p.toString()),p.collapseToStart(),p.setPosition(o[0],o[1]),n.showCursor()}},{annotation:"Copy selected text",feature_group:9,code:function(){var t=[p.focusNode,p.focusOffset];e.write(p.toString()),"Caret"===d.conf.modeAfterYank?(p.setPosition(t[0],t[1]),n.showCursor(),g=1,P()):"Normal"===d.conf.modeAfterYank&&(g=2,n.toggle())}}];function u(e,t){ee(e,(()=>{b(e,["click"],t)}))}n.mappings.add("*",{annotation:"Search word under the cursor",feature_group:9,code:function(){n.star()}}),n.mappings.add(i.encodeKeystroke("<Enter>"),{annotation:"Click on node under cursor.",feature_group:9,code:function(){u(p.focusNode.parentNode,!1)}}),n.mappings.add(i.encodeKeystroke("<Shift-Enter>"),{annotation:"Click on node under cursor.",feature_group:9,code:function(){u(p.focusNode.parentNode,!0)}}),n.mappings.add("zt",{annotation:"make cursor at top of window.",feature_group:9,code:function(){var e=w.getBoundingClientRect().top;n.hideCursor(),document.scrollingElement.scrollTop+=e,n.showCursor()}}),n.mappings.add("zz",{annotation:"make cursor at center of window.",feature_group:9,code:function(){var e=w.getBoundingClientRect().top-window.innerHeight/2;n.hideCursor(),document.scrollingElement.scrollTop+=e,n.showCursor()}}),n.mappings.add("zb",{annotation:"make cursor at bottom of window.",feature_group:9,code:function(){var e=window.innerHeight-w.getBoundingClientRect().bottom;n.hideCursor(),document.scrollingElement.scrollTop-=e,n.showCursor()}}),n.mappings.add("f",{annotation:"Forward to next char.",feature_group:9,code:function(){n.statusLine=n.name+" - "+y[g]+" - forward",de.showStatus(),k=1}}),n.mappings.add("F",{annotation:"Backward to next char.",feature_group:9,code:function(){n.statusLine=n.name+" - "+y[g]+" - backward",de.showStatus(),k=-1}}),n.mappings.add(";",{annotation:"Repeat latest f, F",feature_group:9,code:function(){E&&S(E[0],E[1])}}),n.mappings.add(",",{annotation:"Repeat latest f, F in opposite direction",feature_group:9,code:function(){E&&S(-E[0],E[1])}}),n.mappings.add("p",{annotation:"Expand selection to parent element",feature_group:9,code:function(){for(var e=p.focusNode;e!==document.body;){var t=U(e=e.parentElement,/./),o=t[t.length-1],r=p.getRangeAt(0);if(-1===r.comparePoint(t[0],0)||1===r.comparePoint(o,o.length)){n.hideCursor(),g=2,P(),p.setBaseAndExtent(t[0],0,o,o.length),n.showCursor();break}}}}),n.mappings.add("V",{annotation:"Select a word(w) or line(l) or sentence(s) or paragraph(p)",feature_group:9,code:function(e){n.hideCursor(),g=2,P(),c(e),n.showCursor()}});var p=document.getSelection(),m=[],h=0,g=0,y=["","Caret","Range"],v=document.createElement("div"),w=document.createElement("div");w.className="surfingkeys_cursor",w.style.zIndex=2147483299;var k=0,E=null;function S(e,t){n.hideCursor();var o=[p.anchorNode,p.anchorOffset];if(p.focusNode&&p.focusNode.textContent&&p.focusNode.textContent.length&&p.focusNode.textContent[p.focusOffset]===t&&1===e&&p.setPosition(p.focusNode,p.focusOffset+1),D(t,!0,-1===e))if(1===g)p.setPosition(p.focusNode,p.focusOffset-1);else{var r=[p.focusNode,p.focusOffset-1];p.collapseToStart(),p.setPosition(o[0],o[1]),p.extend(r[0],r[1])}else p.setPosition(o[0],o[1]);n.showCursor()}function x(e){n.hideCursor(),p.anchorNode&&2===g?p.extend(e[0],e[1]):p.setPosition(e[0],e[1]),n.showCursor()}function C(){var e=n.map_node.meta.annotation.split(" "),t=2===g?"extend":"move";n.hideCursor();var o=[p.focusNode,p.focusOffset];p.modify(t,e[0],e[1]),o[0]===p.focusNode&&o[1]===p.focusOffset&&p.modify(t,e[0],"word"),n.showCursor()}n.hideCursor=function(){document.body.contains(w)&&(w.remove(),a("cursorHidden"))},n.showCursor=function(){if(p.focusNode&&(p.focusNode.offsetHeight>0||p.focusNode.parentNode.offsetHeight>0)){T(p.focusNode.parentElement,!0);var e=H(p.focusNode,p.focusOffset)[0];e||(e=p.focusNode.getBoundingClientRect()),e&&(w.style.position="fixed",w.style.left=e.left+"px",e.left<0||e.left>=window.innerWidth?(document.scrollingElement.scrollLeft+=e.left-window.innerWidth/2,w.style.left=window.innerWidth/2+"px"):w.style.left=e.left+"px",e.top<0||e.top>=window.innerHeight?(document.scrollingElement.scrollTop+=e.top-window.innerHeight/2,w.style.top=window.innerHeight/2+"px"):w.style.top=e.top+"px",w.style.height=e.height+"px"),document.body.appendChild(w)}},n.getCursorPixelPos=function(){return w.getBoundingClientRect()};const O=document.createElement("div");function N(e,t,n,o,r){let i=H(t,n,o,r);if(i.length>100)return[];const a=Array.from(i).map((t=>{if(t.width>0&&t.height>0){var n=v.cloneNode(!1);return n.className=e,n.style.position="absolute",n.style.zIndex=2147483299,n.style.left=document.scrollingElement.scrollLeft+t.left+"px",n.style.top=document.scrollingElement.scrollTop+t.top+"px",n.style.width=t.width+"px",n.style.height=t.height+"px",O.appendChild(n),n}return null})).filter((e=>null!==e));return a.length&&!document.documentElement.contains(O)&&document.documentElement.prepend(O),a}function M(e,t,n,o){const r=N("surfingkeys_match_mark",e,t,n,o);r.length&&m.push([e,t,r])}function R(e){U(document.body,e).forEach((function(t){for(var n;null!==(n=e.exec(t.data));){var o=n[0];if(!o.length)break;var r=e.lastIndex-o.length;M(t,r,t,r+o.length)}}));var t=document.scrollingElement.scrollTop;for(p.setPosition(null,0);D(e.source,-1===e.flags.indexOf("i"),!1);)p.anchorNode!==p.focusNode&&M(p.anchorNode,p.anchorOffset,p.focusNode,p.focusOffset);if(document.scrollingElement.scrollTop=t,m.length){h=0;for(var n=0;n<m.length;n++){if(m[n][2][0].getBoundingClientRect().top>0){h=n;break}}a("showStatus",[[void 0,void 0,h+1+" / "+m.length]])}}function I(){a("hideBubble")}function P(){n.mappings.add("y",l[g]),n.statusLine=n.name+" - "+y[g],de.showStatus()}function F(){g=(g+1)%3,P()}function D(e,t,n){for(var o=!1,r=null;window.find(e,t,n);){if(p.anchorNode.splitText){o=!0;break}if(null===r)r=p.anchorNode;else if(r===p.anchorNode)break}return o}n.visualClear=function(){r(),n.hideCursor(),m=[],B.forEach((function(e){e.onscroll=null})),B=[],Q(O,""),O.remove(),a("showStatus",[[void 0,void 0,""]])},n.emptySelection=function(){document.getSelection().empty()},n.onEnter=function(){document.addEventListener("surfingkeys:cursorHidden",I),F()},n.onExit=function(){n.visualClear(),document.removeEventListener("surfingkeys:cursorHidden",I)},n.restore=function(){p&&p.anchorNode&&(p.setPosition(p.anchorNode,p.anchorOffset),n.showCursor(),n.enter())},n.toggle=function(e){switch(g){case 1:p.extend(p.anchorNode,p.anchorOffset),F();break;case 2:n.hideCursor(),p.collapse(p.focusNode,p.focusOffset),n.exit(),F();break;default:t.create(d.conf.textAnchorPat,(function(t){setTimeout((function(){p.setPosition(t[0],t[1]),n.enter(),"z"===e&&(0===t[1]?p.extend(t[0],t[0].textContent.length):p.extend(t[0],t[1]+t[2].length),F()),n.showCursor()}),0)}))}},n.star=function(){if(p.focusNode&&p.focusNode.nodeValue){var e=K();if(e.length&&"."!==e){n.hideCursor();var t=[p.focusNode,p.focusOffset];d.updateHistory("find",e),n.visualClear(),R(new RegExp(e,"g"+(d.getCaseSensitive(e)?"":"i"))),p.setPosition(t[0],t[1]),n.showCursor()}}},n.next=function(e){m.length?(0===g&&n.enter(),h=(e?m.length+h-1:h+1)%m.length,x(m[h]),a("showStatus",[[void 0,void 0,h+1+" / "+m.length]])):d.conf.lastQuery&&(R(new RegExp(d.conf.lastQuery,"g"+(d.getCaseSensitive(d.conf.lastQuery)?"":"i"))),n.visualEnter(d.conf.lastQuery))},n.feedkeys=function(e){setTimeout((function(){for(var t=new Event("keydown"),o=0;o<e.length;o++)t.sk_keyName=e[o],de.handleMapKey.call(n,t)}),1)},n.visualUpdate=function(e){n.visualClear(),p.setPosition(function(e){for(var t=null,n=U(document.body,/./,0);n.nextNode();)if(n.currentNode.parentNode.getBoundingClientRect().top>window.innerHeight*e){t=n.currentNode;break}return t}(0),0);var t=document.scrollingElement.scrollTop,o=[p.anchorNode,p.anchorOffset],r=d.getCaseSensitive(e);if(D(e,r,!1)?p.setPosition(o[0],o[1]):p.setPosition(document.body.firstChild,0),D(e,r,!1)){for(document.scrollingElement.scrollTop!==t&&(t=document.scrollingElement.scrollTop,o=[p.anchorNode,p.anchorOffset]),M(p.anchorNode,p.anchorOffset,p.focusNode,p.focusOffset);document.scrollingElement.scrollTop===t&&D(e,r,!1);)M(p.anchorNode,p.anchorOffset,p.focusNode,p.focusOffset);document.scrollingElement.scrollTop=t,p.setPosition(o[0],o[1])}};var B=[];n.visualEnter=function(e){0!==e.length&&"."!==e&&(n.visualClear(),R(new RegExp(e,"g"+(d.getCaseSensitive(e)?"":"i"))),m.length?(n.enter(),x(m[h])):a("showStatus",[[void 0,void 0,"Pattern not found: {0}".format(e)],1e3]),de.getScrollableElements().forEach((function(e){e!==document.scrollingElement&&(e.onscroll=function(){m.forEach((function(e){var t=H(e[0],e[1])[0];e[2].forEach((e=>{e.style.left=document.scrollingElement.scrollLeft+t.left+"px",e.style.top=document.scrollingElement.scrollTop+t.top+"px"}))}))},B.push(e))})))},n.findSentenceOf=function(e){var t=new RegExp("\\b"+e+"\\b"),n=L((function(e,n){t.test(e.innerText)&&n.push(e)}));n=A(n);var o="";return _((function(t){t.setPosition(n[0],0),window.find(e,!1,!1,!0,!0)&&(c("s"),o=t.toString())})),o};var q={};return n.style=function(e,t){q[e]=t,w.setAttribute("style",q.cursor||""),v.setAttribute("style",q.marks||"")},n};const ve=function(e,t){var n=new de("Hints"),o=document.createElement("div");o.className="surfingkeys_hints_host",o.attachShadow({mode:"open"});var r=$("style","\ndiv {\n    position: absolute;\n    display: block;\n    font-size: 8pt;\n    font-weight: bold;\n    padding: 0px 2px 0px 2px;\n    background: -webkit-gradient(linear, left top, left bottom, color-stop(0%,#FFF785), color-stop(100%,#FFC542));\n    color: #000;\n    border: solid 1px #C38A22;\n    border-radius: 3px;\n    box-shadow: 0px 3px 7px 0px rgba(0, 0, 0, 0.3);\n    width: auto;\n}\ndiv:empty {\n    display: none;\n}\n[mode=text] div {\n    background: -webkit-gradient(linear, left top, left bottom, color-stop(0%,#aaa), color-stop(100%,#fff));\n}\ndiv.hint-scrollable {\n    background: rgba(170, 170, 255, 0.85);\n}\n[mode=text] div.begin {\n    color: #00f;\n}\n[mode=input] div {\n    background: rgba(255, 217, 0, 0.25);\n}\n[mode=input] div.activeInput {\n    background: rgba(0, 0, 255, 0.25);\n}");o.shadowRoot.appendChild(r);let c=!1;n.setNumeric=function(){c=!0};let l="asdfgqwertzxcvb",u=[];n.setCharacters=function(e){l=e;for(const n of e)t.isScrollKeyInHints(n)&&u.push(n)},n.getCharacters=()=>l,n.addEventListener("keydown",(function(n){var o=v.querySelectorAll("div");n.sk_stopPropagation=!0;var r=v.querySelector("[mode=input]>div.activeInput");if(null===r){if(de.isSpecialKeyOf("<Esc>",n.sk_keyName))N();else if(n.keyCode===i.keyCodes.space)v.style.display="none";else if(n.keyCode===i.keyCodes.shiftKey)!function(){var e=v.querySelectorAll("div");e[0].style.zIndex==e[0].zIndex?e.forEach((function(t,n){var o=parseInt(t.style.zIndex);t.style.zIndex=e.length-n+2147483e3-o})):e.forEach((function(e,t){e.style.zIndex=e.zIndex}))}();else if(o.length>0)if(n.keyCode===i.keyCodes.backspace)p.length>0?(p=p.substr(0,p.length-1),T(n)):m.length>0&&(m=m.substr(0,m.length-1),O());else{var a=n.sk_keyName;(function(e){return e===e.toUpperCase()&&e!==e.toLowerCase()})(a)&&(w=!0),""!==a&&(c?(a>="0"&&a<="9"?p+=a:(m+=a,O()),T(n)):-1!==l.toLowerCase().indexOf(a.toLowerCase())?(p+=a.toUpperCase(),T(n)):t.isScrollKeyInHints(a)&&-1===u.indexOf(a)?n.sk_stopPropagation=!1:N())}}else{var s=r.link;de.isSpecialKeyOf("<Esc>",n.sk_keyName)?(s.blur(),N()):n.keyCode===i.keyCodes.tab?(r.classList.remove("activeInput"),k.activeInput=(k.activeInput+(n.shiftKey?-1:1))%o.length,(r=o[k.activeInput]).classList.add("activeInput"),(s=r.link).focus()):n.keyCode!==i.keyCodes.shiftKey&&(n.sk_stopPropagation=!1,N(),e.enter(s))}})),n.addEventListener("keyup",(function(e){e.keyCode===i.keyCodes.space&&(v.style.display="")}));var p="",m="",h=null,g={mouseEvents:["mouseover","mousedown","mouseup","click"]},v=$("section","",{style:"display: block; opacity: 1;"}),w=!1,k={},E=n.dispatchMouseClick,S="";function C(e){var t=0;do{var n=parseInt(getComputedStyle(e).getPropertyValue("z-index"));t+=isNaN(n)||n<0?0:n,e=e.parentNode}while(e&&e!==document.body&&e!==document&&e.nodeType!==e.DOCUMENT_FRAGMENT_NODE);return t}function T(e){const n=v.querySelectorAll("div:not(:empty)"),o=te(n,p);o.matched?(t.appendKeysForRepeat("Hints",p),E(o.matched),g.multipleHits?te(n,p=""):N()):0===o.candidates&&N(),e&&(de.suppressKeyUp(e.keyCode),e.stopImmediatePropagation(),e.preventDefault())}function O(){var e=v.querySelectorAll("div");e=Array.from(e),m.length>0&&(e=e.filter((function(e){e.label="",Q(e,"");var t=e.link,n=t.innerText;return void 0===n&&(n=t[0]?t[0].textContent:""),-1!==n.indexOf(m)})));var t=n.genLabels(e.length);e.forEach((function(e,n){e.label=t[n],Q(e,t[n])}))}function N(){g={active:!0,tabbed:!1,mouseEvents:["mouseover","mousedown","mouseup","click"],multipleHits:!1},Q(v,""),v.remove(),o.remove(),p="",m="",w=!1,n.exit()}function _(e){Q(v,""),v.remove(),p=""}function A(){if(document.documentElement.contains(o)){var e=(new Date).getTime(),t=K(S,k);t>0&&(n.statusLine+=" - "+((new Date).getTime()-e)+"ms / "+t,de.showStatus())}}function R(e){for(var t=e.href;!t&&e;)t=(e=e.parentElement).href;return t}function U(e){for(var t=0;t<d.conf.pageUrlRegex.length;t++){var n=window.location.href.match(d.conf.pageUrlRegex[t]);if(n&&4===n.length){var o=parseInt(n[2]);if(o<4294967295)return window.location.href=n[1]+(o+e)+n[3],!0}}return!1}function D(e){let t={};return e.forEach((function(e){let n=e.getAttribute("href");t[n]||(t[n]=e)})),Object.values(t)}function H(e){Q(v,""),v.setAttribute("mode",e),v.style.display=""}function B(e){H("click");var t=n.genLabels(e.length),r=n.coordinate(),i=$("style",j);v.prepend(i);var a=e.map((function(e,n){var o,i=M(e),a=C(e),s=Math.min(i.width,window.innerWidth);(o="right"===d.conf.hintAlign?window.pageXOffset+i.left-r.left+s:"left"===d.conf.hintAlign?window.pageXOffset+i.left-r.left:window.pageXOffset+i.left-r.left+s/2)<window.pageXOffset?o=window.pageXOffset:o+32>window.pageXOffset+window.innerWidth&&(o=window.pageXOffset+window.innerWidth-32);var c=$("div",t[n]);return e.dataset.hint_scrollable&&c.classList.add("hint-scrollable"),c.style.top=Math.max(i.top+window.pageYOffset-r.top,0)+"px",c.style.left=o+"px",c.style.zIndex=a+9999,c.zIndex=c.style.zIndex,c.label=t[n],c.link=e,c}));a.forEach((function(e){v.appendChild(e)}));for(var s=v.querySelectorAll("div"),c=M(s[0]),l=1;l<s.length;l++){var u=s[l],f=M(u);f.top===c.top&&Math.abs(f.left-c.left)<c.width&&(u.style.top=u.offsetTop+u.offsetHeight+"px"),c=M(u)}o.shadowRoot.appendChild(v)}function K(e,t){return document.documentElement.appendChild(o),"RegExp"===e.constructor.name?function(e,t){for(var r in t)g[r]=t[r];n.statusLine=t&&t.statusLine||"Hints to select text";var i,a=L((function(e,t){for(var n=e.childNodes,o=0,r=n.length;o<r;o++)if(n[o].nodeType==Node.TEXT_NODE&&n[o].data.length>0){t.push(e);break}}));if(a=a.flatMap((function(e){for(var t=e.childNodes,n=[],o=0,r=t.length;o<r;o++)t[o].nodeType==Node.TEXT_NODE&&t[o].data.trim().length>1&&n.push(t[o]);return n})),-1===e.flags.indexOf("g"))i=a.map((function(e){return[e,0,""]}));else{i=[];for(var s=0,c=a.length;s<c;s++)for(var l,u=a[s];null!=(l=e.exec(u.data));)i.push([u,l.index,l[0]])}if(a=i.map((function(e){var t=F(e[0],e[1]),n=[0,0,window.innerHeight,window.innerWidth];if(d.conf.caretViewport&&4===d.conf.caretViewport.length&&(n=d.conf.caretViewport),0===e[0].data.trim().length||t.top<n[0]||t.left<n[1]||t.top>n[2]||t.left>n[3])return null;var o=C(e[0].parentNode),r=document.createElement("div");return 0===e[1]&&(r.className="begin"),r.style.position="fixed",r.style.top=t.top+"px",r.style.left=t.left+"px",r.style.zIndex=o+9999,r.zIndex=r.style.zIndex,r.link=e,r})).filter((function(e){return null!==e})),document.getSelection().anchorNode&&document.getSelection().collapseToStart(),a.length>0){H("text");var f=n.genLabels(a.length);a.forEach((function(e,t){e.label=f[t],Q(e,f[t]),v.append(e)}));var p=$("style",q);v.prepend(p),o.shadowRoot.appendChild(v)}return a.length}(e,t):Array.isArray(e)?function(e,t){for(var o in t=Object.assign({active:!0,tabbed:!1,mouseEvents:["mouseover","mousedown","mouseup","click"],multipleHits:!1,filterInvisible:!0},t||{}))g[o]=t[o];return n.statusLine=t&&t.statusLine||"Hints to click",t.filterInvisible&&(e=G(e)),e.length>0&&B(e),e.length}(e,t):function(e,t){for(var o in n.statusLine="Hints to click",t=Object.assign({active:!0,tabbed:!1,mouseEvents:["mouseover","mousedown","mouseup","click"],multipleHits:!1},t||{}))g[o]=t[o];var r;return(r=""===e?I(r=L((function(e,t){y(e)&&t.push(e)}))):Array.isArray(e)?G(e):I(r=G(r=L((function(t,n){!t.matches(e)||t.disabled||t.readOnly||n.push(t)}))))).length>0&&B(r),r.length}(e,t)}n.click=function(e,t){"string"==typeof e&&(e=P(e)),e.length>1?t?e.forEach((function(e){n.dispatchMouseClick(e)})):n.create(e,n.dispatchMouseClick):1===e.length&&n.dispatchMouseClick(e[0])},n.previousPage=function(){var e=D(P("[rel=prev]",d.conf.prevLinkRegex));return e.length?(n.click(e),!0):U(-1)},n.nextPage=function(){var e=D(P("[rel=next]",d.conf.nextLinkRegex));return e.length?(n.click(e),!0):U(1)},document.addEventListener("surfingkeys:topBoundaryHit",n.previousPage),document.addEventListener("surfingkeys:bottomBoundaryHit",n.nextPage),n.onEnter=function(){document.addEventListener("surfingkeys:scrollStarted",_),document.addEventListener("surfingkeys:scrollDone",A)},n.onExit=function(){document.removeEventListener("surfingkeys:scrollStarted",_),document.removeEventListener("surfingkeys:scrollDone",A)},n.genLabels=function(e){var t,n,o,r,i,a;for(o=[""],a=0;o.length-a<e||1===o.length;)for(n=o[a++],r=0,i=l.length;r<i;r++)t=l[r],o.push(t+n);return(o=o.slice(a,a+e)).map((function(e){return e.reverse().toUpperCase()}))},n.coordinate=function(){var e=$("div","A",{style:"top: 0; left: 0;"});v.prepend(e),o.shadowRoot.appendChild(v);var t=e.getBoundingClientRect(),n={top:t.top+window.pageYOffset-document.documentElement.clientTop,left:t.left+window.pageXOffset-document.documentElement.clientLeft};return Q(v,""),v.remove(),n},n.createInputLayer=function(){document.documentElement.appendChild(o);const r="input:not([type=submit]), textarea, *[contenteditable=true], *[role=textbox], select, div.ace_cursor";var i=L((function(e,t){!e.matches(r)||e.disabled||e.readOnly||"text"!==e.type&&"email"!==e.type&&"search"!==e.type&&"password"!==e.type||t.push(e)}));if(0===i.length&&null!==document.querySelector(r)&&(document.querySelector(r).scrollIntoView(),i=L((function(e,t){!e.matches(r)||e.disabled||e.readOnly||t.push(e)}))),i.length>1){n.enter(),H("input"),i.forEach((function(e,t){var n=e.getBoundingClientRect(),o=C(e),r=document.createElement("div");r.style.position="fixed",r.style.top=n.top+"px",r.style.left=n.left+"px",r.style.width=n.width+"px",r.style.height=n.height+"px",r.style.zIndex=o+9999,r.link=e,r.innerText=" ",v.append(r)})),o.shadowRoot.appendChild(v),k.activeInput=0;var a=v.querySelector("[mode=input]>div");a.classList.add("activeInput"),t.passFocus(!0),a.link.focus()}else 1===i.length&&(t.passFocus(!0),i[0].focus(),e.enter(i[0]))},n.getSelector=function(){return S},n.create=function(e,t,o){c&&(l="1234567890"),S=e,E=t,k=o||{};var r=(new Date).getTime(),i=K(e,o);return i>(d.conf.hintExplicit?0:1)?(n.statusLine+=" - "+((new Date).getTime()-r)+"ms / "+i,n.enter()):T(),i>0},n.dispatchMouseClick=function(o,r){if(x(o))n.exit(),t.passFocus(!0),o.focus(),e.enter(o);else{g.multipleHits||n.exit();var i=g.tabbed,c=g.active;if(g.multipleHits){const e=o.getAttribute("href");null!==e&&"#"!==e&&(i=!0,c=!1)}w&&d.conf.hintShiftNonActive?(i=!0,c=!1):w&&"Firefox"===f()&&(i=!0,c=!0),ee(o,(()=>{i?s("openLink",{tab:{tabbed:i,active:c},url:R(o)}):(n.mouseoutLastElement(),b(o,g.mouseEvents,w),a("turnOnDOMObserver"),h=o),g.multipleHits&&setTimeout(A,300)}))}},n.mouseoutLastElement=function(){h&&(b(h,["mouseout"],!1),h=null)};var q="",j="";return n.style=function(e,t){/^div\b/.test(e)||(e=`div{${e}}`),"text"===t?q=e.replace(/\bdiv\b/g,"[mode='text'] div"):j=e.replace(/\bdiv\b/g,"div")},n.feedkeys=function(e){setTimeout((function(){p=e.toUpperCase(),T()}),1)},n};const we=function(){var e={},t=document.createElement("textarea");function n(e){_((function(n){document.documentElement.appendChild(t),e(n),t.remove()}))}return t.contentEditable=!0,t.enableAutoFocus=!0,t.id="sk_clipboard",e.read=function(e){if(f().startsWith("Safari"))s("readClipboard",null,(function(t){e(t)}));else if("Firefox"!==f()||"object"!=typeof navigator.clipboard||"function"!=typeof navigator.clipboard.readText){n((function(){t.value="",Q(t,""),t.focus(),document.execCommand("paste")}));var o=t.value;""===o&&(o=t.innerHTML.replace(/<br>/gi,"\n")),e({data:o})}else navigator.clipboard.readText().then((t=>{setTimeout((function(){e({data:t})}),0)}))},e.write=function(e){const o=()=>{v("Copied: "+e)};"Chrome"===f()?X((function(){window.oncopy=document.oncopy,document.oncopy=null}),(function(){n((function(){t.value=e,t.select(),document.execCommand("copy"),t.value=""})),X((function(){document.oncopy=window.oncopy,delete window.oncopy})),o()})):(s("writeClipboard",{text:e}),o())},e};const be=function(e,t){var n=document.createElement("div");n.style.display="block",n.style.opacity=1,n.style.colorScheme="light";var o=chrome.runtime.getURL("pages/frontend.html"),r=document.createElement("iframe");function i(e){var t=e.data&&e.data.surfingkeys_uihost_data;void 0!==t&&(t.toFrontend?(r.contentWindow.postMessage({surfingkeys_frontend_data:t},o),t.toFrontend&&e.source&&-1!==["showStatus","showEditor","openOmnibar","openFinder","chooseTab"].indexOf(t.action)&&(l&&l.window===e.source||(l&&l.window.postMessage({surfingkeys_content_data:{action:"deactivated",reason:`${t.action}@${e.timeStamp}`}},l.origin),(l={window:e.source,origin:t.origin}).window.postMessage({surfingkeys_content_data:{action:"activated",reason:`${t.action}@${e.timeStamp}`}},l.origin)))):t.action&&c.hasOwnProperty(t.action)?c[t.action](t):t.toContent&&l&&l.window.postMessage({surfingkeys_content_data:t},l.origin),e.stopImmediatePropagation())}r.setAttribute("allowtransparency",!0),r.setAttribute("frameborder",0),r.setAttribute("scrolling","no"),r.setAttribute("class","sk_ui"),r.setAttribute("src",o),r.setAttribute("title","Surfingkeys"),r.style.position="fixed",r.style.left=0,r.style.bottom=0,r.style.width="100%",r.style.height=0,r.style.zIndex=2147483647,n.attachShadow({mode:"open"}),n.shadowRoot.appendChild(r),r.addEventListener("load",(function(){this.contentWindow.postMessage({surfingkeys_frontend_data:{action:"initFrontend",ack:!0,winSize:[window.innerWidth,window.innerHeight],origin:m()}},o),window.addEventListener("message",i,!0)}),{once:!0});var a,s="none",c={},l=null;c.initFrontendAck=function(e){t(n)},c.setFrontFrame=function(t){r.style.height=t.frameHeight,t.pointerEvents&&(r.style.pointerEvents=t.pointerEvents),"none"===t.pointerEvents?(n.blur(),r.blur(),s!==t.pointerEvents&&l&&(e.getBackFocusFromFrontend?e.getBackFocusFromFrontend():l.window.postMessage({surfingkeys_content_data:{action:"getBackFocus"}},l.origin)),document.body&&(document.body.style.animationFillMode="",document.body.style.overflowY=a)):(e.focusFrontend&&e.focusFrontend(r),document.body&&(document.body.style.animationFillMode="none",void 0===a&&(a=document.body.style.overflowY),document.body.style.overflowY="visible")),s=t.pointerEvents},n.detach=function(){window.removeEventListener("message",i,!0),n.remove()},document.documentElement.appendChild(n)};const ke=function(e,t,n,o,r){var i,c={},l=[];function u(){i=new Promise((function(e,t){be(r,(t=>{e(t),function(){for(var e of l)e.toFrontend=!0,e.origin=m(),e.id=h(),d.postTopMessage(e)}()}))}))}var g={};c.command=function(e,t){if(e.toFrontend=!0,e.origin=m(),e.id=h(),t&&(e.ack=!0,g[e.id]=t),window!==top)d.postTopMessage(e);else{if(!i){if("hideKeystroke"===e.action)return;u()}i.then((function(){d.postTopMessage(e)}))}},document.addEventListener("surfingkeys:setUserSettings",(function(e){l.push({action:"applyUserSettings",userSettings:e.detail})}));var y={};c.addSearchAlias=function(e,t,n,o,r,i){o&&r&&(y[o]=r),l.push({action:"addSearchAlias",alias:e,prompt:t,url:n,suggestionURL:o,options:i})},c.removeSearchAlias=function(e){l.push({action:"removeSearchAlias",alias:e})};var v={};function w(){var e=document.getSelection(),t=e.toString().trim();t&&!/[\W_]/.test(t)&&t.length&&"Range"===e.type&&c.performInlineQueryOnSelection(t)}c.performInlineQueryOnSelection=function(e){var t=document.getSelection().getRangeAt(0).getClientRects()[0];c.performInlineQuery(e,t,(function(e,t){t&&a("showBubble",[{top:e.top,left:e.left,height:e.height,width:e.width},t,!1])}))},document.addEventListener("surfingkeys:querySelectedWord",w),v.updateInlineQuery=function(e){e.word?c.performInlineQueryOnSelection(e.word):w()},v.getSearchSuggestions=function(e){var t=null;return y.hasOwnProperty(e.url)&&(t=y[e.url](e.response,{url:e.requestUrl,query:e.query})),t},c.executeCommand=function(e){c.command({action:"executeCommand",cmdline:e})},document.addEventListener("surfingkeys:addMapkey",(function(e){const[t,n,o]=e.detail;l.push({action:"addMapkey",mode:t,new_keystroke:n,old_keystroke:o})})),document.addEventListener("surfingkeys:addVimMap",(function(e){const[t,n,o]=e.detail;l.push({action:"addVimMap",lhs:t,rhs:n,ctx:o})})),document.addEventListener("surfingkeys:addVimKeyMap",(function(e){l.push({action:"addVimKeyMap",vimKeyMap:e.detail})}));var b,k,E,S,C=$("div","Hi, I'm here now!",{id:"sk_frame"});function T(e){document.documentElement.append(C);var t=e.rect;C.style.top=t.top+"px",C.style.left=t.left+"px",C.style.width=t.width+"px",C.style.height=t.height+"px",C.style.display="",setTimeout((function(){C.remove()}),e.duration)}function O(){let n=[t.mappings,o.mappings,e.mappings];const r=t.getLurkMode();return r&&n.unshift(r.mappings),n.map(z).reduce((function(e,t){return e.concat(t)}))}function N(){c.command({action:"hidePopup"})}function L(e){if("DIV"===k.nodeName)if("CodeMirror-code"===k.className){window.getSelection().selectAllChildren(k);let t=new DataTransfer;t.items.add(e,"text/plain"),k.dispatchEvent(new ClipboardEvent("paste",{clipboardData:t}))}else e=e.replace(/\n+$/,""),"function"==typeof k.setEditorText?k.setEditorText(e):k.innerText=e;else if("function"==typeof k.setValueWithEventDispatched)k.setValueWithEventDispatched(e);else{k.value=e;var t=document.createEvent("HTMLEvents");t.initEvent("change",!1,!0),k.dispatchEvent(t)}}C.fromSurfingKeys=!0,document.addEventListener("surfingkeys:highlightElement",(function(e){T(e.detail)})),c.showUsage=function(){c.command({action:"showUsage",metas:O()})},c.getUsage=function(e){c.command({action:"getUsage",metas:O()},(function(t){e(t.data)}))},document.addEventListener("surfingkeys:showPopup",(function(e){const[t]=e.detail;c.command({action:"showPopup",content:t})})),document.addEventListener("surfingkeys:hidePopup",N),c.showEditor=function(e,t,n,o){n=n||e.localName;var r,i=0;if("string"==typeof e)r=e,k=document.body;else if("select"===n){var a=e.value;r=Array.from(e.querySelectorAll("option")).map((function(e,t){return e.value===a&&(i=t),e.innerText.trim()+" >< "+e.value})).join("\n"),k=e}else if("DIV"===(k=e).nodeName)if("CodeMirror-code"===k.className){let e=k.querySelectorAll(".CodeMirror-line");r=(r=Array.from(e).map((e=>e.innerText)).join("\n")).replace(/\u200B/g,"")}else r=k.innerText;else r=k.value;b=t||L;const s={action:"showEditor",type:n||"textarea",initial_line:i,content:r};(o||d.conf.useNeovim)&&(s.file_name=`${new URL(window.location.origin).host}/${k.nodeName.toLowerCase()}`),c.command(s)},c.chooseTab=function(){""!==t.repeats?s("focusTabByIndex"):c.command({action:"chooseTab"})},c.openOmnibar=function(e){e.action="openOmnibar",c.command(e)},c.performInlineQuery=function(e,t,n){var o,i;void 0!==document.dictEnabled?document.dictEnabled&&("dictorium:"===window.location.protocol?window===top?window.location.href=e:window.postMessage({dictorium_data:{type:"DictoriumReload",word:e}}):window.postMessage({dictorium_data:{type:"OpenDictoriumQuery",word:e,sentence:"",pos:t,source:window.location.href}}),N()):E?(d.conf.autoSpeakOnInlineQuery&&r.readText(e),e=e.toLocaleLowerCase(),d.updateHistory("OmniQuery",e),o={url:"function"==typeof E.url?E.url(e):E.url+e,headers:E.headers},i=function(e){n(t,E.parseResult(e))},o.method="get",s("request",o,i)):p()?(S=function(e){n(t,e)},document.getElementById("proxyFrame").contentWindow.postMessage({surfingkeys_content_data:{action:"performInlineQuery",pos:t,query:e}},"*")):(V("https://github.com/brookhong/Surfingkeys/wiki/Register-inline-query"),N())},c.registerInlineQuery=function(e){E=e},c.openOmniquery=function(e){c.openOmnibar({type:"OmniQuery",extra:e.query,style:e.style})},document.addEventListener("surfingkeys:openFinder",(function(e){c.command({action:"openFinder"})})),document.addEventListener("surfingkeys:showBanner",(function(e){const[t,n]=e.detail;c.command({action:"showBanner",content:t,linger_time:n})})),document.addEventListener("surfingkeys:showBubble",(function(e){const[t,n,o]=e.detail;n.length>0&&(t.winWidth=window.innerWidth,t.winHeight=window.innerHeight,t.winX=0,t.winY=0,window.frameElement&&(t.winX=window.frameElement.offsetLeft,t.winY=window.frameElement.offsetTop),c.command({action:"showBubble",content:n,position:t,noPointerEvents:o}))})),document.addEventListener("surfingkeys:hideBubble",(function(e){c.command({action:"hideBubble"})}));var _,A={accumulated:"",candidates:{},key:""};function M(){_&&(clearTimeout(_),_=void 0)}document.addEventListener("surfingkeys:hideKeystroke",(function(e){A.accumulated="",A.candidates={},c.command({action:"hideKeystroke"})})),document.addEventListener("surfingkeys:showKeystroke",(function(e){const[t,n]=e.detail;A.accumulated+=t,A.key=t,A.candidates={};var o=n.mappings.find(A.accumulated);o&&o.getMetas((function(e){return!0})).forEach((function(e){A.candidates[e.word]={annotation:e.annotation}})),c.command({action:"showKeystroke",keyHints:A})})),document.addEventListener("surfingkeys:showStatus",(function(e){c.showStatus(...e.detail)})),c.showStatus=function(e,t){c.command({action:"showStatus",contents:e,duration:t})},c.toggleStatus=function(e){c.command({action:"toggleStatus",visible:e})},v.ace_editor_saved=function(n){void 0!==n.data&&b(n.data),d.conf.focusOnSaved&&x(k)&&(t.passFocus(!0),k.focus(),e.enter(k))},v.nextEdit=function(e){var t=n.getSelector()||"input, textarea, *[contenteditable=true], select";if((t=getElements(t)).length){var o=t.indexOf(k);o=(o+(e.backward?-1:1))%t.length,t=t[o],scrollIntoViewIfNeeded(t),ee(t,(()=>{c.showEditor(t)}))}},v.omnibar_query_entered=function(e){d.updateHistory("OmniQuery",e.query),c.performInlineQuery(e.query,{top:0,left:80,height:0,width:100},(function(t,n){if("Array"!==n.constructor.name&&(n=[n]),"Chrome"===f()){var r=o.findSentenceOf(e.query);r.length>0&&n.push(r)}c.command({action:"updateOmnibarResult",words:n})}))},v.executeScript=function(e){s("executeScript",{code:e.cmdline},(function(e){c.command({action:"updateOmnibarResult",words:e.response})}))},v.getBackFocus=function(e){window.focus(),window===top&&i&&i.then((e=>{e.shadowRoot.contains(document.activeElement)&&document.activeElement.blur()}))},v.getPageText=function(e){return document.body.innerText},v.visualUpdate=function(e){M(),_=setTimeout((function(){o.visualUpdate(e.query),c.command({action:"visualUpdated"})}),500)},v.visualClear=function(e){M(),o.visualClear()},v.visualEnter=function(e){M(),o.visualEnter(e.query)},v.emptySelection=function(e){o.emptySelection()};var R,I=window===top;return v.deactivated=function(e){I=!1},v.activated=function(e){I=!0},d.on("focusFrame",(function(e,t,n){e.frameId===window.frameId&&(window.focus(),document.body.scrollIntoView({behavior:"auto",block:"center",inline:"center"}),T({duration:500,rect:{top:0,left:0,width:window.innerWidth,height:window.innerHeight}}))})),window.addEventListener("message",(function(e){var t=e.data&&(e.data.surfingkeys_content_data||e.data.dictorium_data);if(void 0!==t){if("performInlineQuery"===t.action)c.performInlineQuery(t.query,t.pos,(function(t,n){e.source.postMessage({surfingkeys_content_data:{action:"performInlineQueryResult",pos:t,result:n}},e.origin)}));else if("performInlineQueryResult"===t.action)S(t.pos,t.result);else if(I){if(g[t.id])(0,g[t.id])(t)||delete g[t.id];else if(t.action&&v.hasOwnProperty(t.action)){var n=v[t.action](t);t.ack&&Promise.resolve(n).then((e=>d.postTopMessage({data:e,toFrontend:!0,origin:t.origin,id:t.id})))}}else("activated"===t.action||"DictoriumViewReady"===t.type)&&v.activated(t);e.data.dictorium_data||e.stopImmediatePropagation()}}),!0),c.attach=function(){R&&(clearTimeout(R),R=void 0),i||u()},c.detach=function(){i&&i.then((e=>{R=setTimeout((function(){e.detach(),i=void 0}),3e3)}))},c};const Ee=function(e,t,n,o,r,c,l){function u(e,t,n){var o={code:e};return n&&(o.repeatIgnore=n),t&&(t=j(t),o.feature_group=t.feature_group,o.annotation=t.annotation),o}function p(e){return!e||e.test(document.location.href)||e.test(window.origin)}function m(e,t,n,o,a){if(p((a=a||{}).domain)){t=i.encodeKeystroke(t);var s=e.mappings.remove(t);if(s)S("warn",s.meta?`${s.meta.word} for [${s.meta.annotation}] is overridden by [${n}].`:s.getMetas((function(){return!0})).map((function(e){return`${e.word} for [${e.annotation}] is overridden by [${n}].`})));else if(t.length>1)for(var c=t.substr(0,t.length-1);c.length>0;){if((s=e.mappings.find(c))&&s.meta)return void S("warn",`${s.meta.word} for [${s.meta.annotation}] precedes ${t}.`);c=c.substr(0,c.length-1)}var l=u(o,{annotation:n,feature_group:e===r?9:14},a.repeatIgnore);e.mappings.add(t,l)}}function h(e,t,o,r){m(n,e,t,o,r)}function g(e,t,n,o){m(r,e,t,n,o)}function y(e,n,o,r){m(t,e,n,o,r)}function b(e,t){if(p(t))if(n.mappings.find(i.encodeKeystroke(e)))n.mappings.remove(i.encodeKeystroke(e));else for(var o in de.specialKeys){var r=de.specialKeys[o].indexOf(e);-1!==r&&de.specialKeys[o].splice(r,1)}}function x(e,t){p(t)&&r.mappings.remove(i.encodeKeystroke(e))}function C(t,n,o,r){e.read((function(e){var i=window.getSelection().toString()||e.data;n&&(i="site:"+window.location.hostname+" "+i),o?c.openOmnibar({type:"SearchEngine",extra:r,pref:i}):V(function(e,t){return e.indexOf("{0}")>0?e.format(t):e.indexOf("%s")>0?e.replace("%s",t):e+t}(t,encodeURIComponent(i)))}))}function T(e){var n=k();n.blur(),t.exit(),c.showEditor(n,null,null,e)}function O(){window.getSelection().toString()?C("https://translate.google.com/?hl=en#auto/en/",!1,!1,""):V("https://translate.google.com/translate?js=n&sl=auto&tl=zh-CN&u="+window.location.href)}return h("[[","#1Click on the previous link on current page",o.previousPage),h("]]","#1Click on the next link on current page",o.nextPage),h("T","#3Choose a tab",(function(){c.chooseTab()})),h("?","#0Show usage",(function(){c.showUsage()})),h("Q","#8Open omnibar for word translation",(function(){c.openOmniquery({query:K(),style:"opacity: 0.8;"})})),y("<Ctrl-'>","#15Toggle quotes in an input element",E),y("<Ctrl-i>","#15Open vim editor for current input",(function(){T(!1)})),"Chrome"===f()&&(y("<Ctrl-Alt-i>","#15Open neovim for current input",(function(){T(!0)})),h(";s","Toggle PDF viewer from SurfingKeys",(function(){var e=window.location.href;0===e.indexOf(chrome.extension.getURL("/pages/pdf_viewer.html"))?(e=window.location.search.substr(3),chrome.storage.local.set({noPdfViewer:1},(function(){window.location.replace(e)}))):document.querySelector("EMBED")&&"application/pdf"===document.querySelector("EMBED").getAttribute("type")?chrome.storage.local.remove("noPdfViewer",(function(){window.location.replace(e)})):chrome.storage.local.get("noPdfViewer",(function(e){e.noPdfViewer?chrome.storage.local.remove("noPdfViewer",(function(){v("PDF viewer enabled.")})):chrome.storage.local.set({noPdfViewer:1},(function(){v("PDF viewer disabled.")}))}))}))),h(";ql","#0Show last action",(function(){w(J(d.conf.lastKeys.map((function(e){return i.decodeKeystroke(e)})).join(" → ")))}),{repeatIgnore:!0}),h("gi","#1Go to the first edit box",(function(){o.createInputLayer()})),h("i","#1Go to edit box",(function(){o.create("input:not([type=submit]), textarea, *[contenteditable=true], *[role=textbox], select, div.ace_cursor",o.dispatchMouseClick)})),h("I","#1Go to edit box with vim editor",(function(){o.create("input:not([type=submit]), textarea, *[contenteditable=true], *[role=textbox], select, div.ace_cursor",(function(e){c.showEditor(e)}))})),h("zv","#9Enter visual mode, and select whole element",(function(){r.toggle("z")})),h("yv","#7Yank text of an element",(function(){o.create(d.conf.textAnchorPat,(function(t){e.write(0===t[1]?t[0].data.trim():t[2].trim())}))})),h("ymv","#7Yank text of multiple elements",(function(){var t=[];o.create(d.conf.textAnchorPat,(function(n){t.push(0===n[1]?n[0].data.trim():n[2].trim()),e.write(t.join("\n"))}),{multipleHits:!0})})),h("V","#9Restore visual mode",(function(){r.restore()})),h("*","#9Find selected text in current page",(function(){r.star(),r.toggle()})),g("<Ctrl-u>","#9Backward 20 lines",(function(){r.feedkeys("20k")})),g("<Ctrl-d>","#9Forward 20 lines",(function(){r.feedkeys("20j")})),h("m","#10Add current URL to vim-like marks",n.addVIMark),h("'","#10Jump to vim-like mark",n.jumpVIMark),h("<Ctrl-'>","#10Jump to vim-like mark in new tab.",(function(e){n.jumpVIMark(e)})),h("w","#2Switch frames",(function(){a("ensureFrontEnd"),window===top&&o.create("iframe",(function(e){e.scrollIntoView({behavior:"auto",block:"center",inline:"center"}),n.highlightElement(e),e.contentWindow.focus()}))||n.rotateFrame()})),h("yg","#7Capture current page",(function(){c.toggleStatus(!1),setTimeout((function(){s("captureVisibleTab",null,(function(e){c.toggleStatus(!0),w("<img src='{0}' />".format(e.dataUrl))}))}),500)})),h("gu","#4Go up one path in the URL",(function(){var e=location.pathname;if(e.length>1){var t=(e=e.endsWith("/")?e.substr(0,e.length-1):e).lastIndexOf("/"),n=s.repeats;for(s.repeats=1;n-- >1;){var o=e.lastIndexOf("/",t-1);if(-1===o)break;t=o}e=e.substr(0,t)}window.location.href=location.origin+e})),h(";m","#1mouse out last element",(function(){o.mouseoutLastElement()})),h(";pp","#7Paste html on current page",(function(){e.read((function(e){document.documentElement.removeAttributes(),document.body.removeAttributes(),Q(document.head,"<title>"+new Date+" updated by Surfingkeys</title>"),Q(document.body,e.data)}))})),h(";t","Translate selected text with google",O),g("t","#9Translate selected text with google",O),h("O","#1Open detected links from text",(function(){o.create(d.conf.clickablePat,(function(e){window.location.assign(e[2])}),{statusLine:"Open detected links from text"})})),h(".","#0Repeat last action",(function(){const e=d.conf.lastKeys;n.feedkeys(e[0]);for(var t=e.slice(1),r=0;r<t.length;r++){var i=t[r].split("\t");if("Hints"===i[0]){function a(){var e=i[1];return function(){o.feedkeys(e)}}setTimeout(a(),120+100*r)}}}),{repeatIgnore:!0}),h("f","#1Open a link, press SHIFT to flip overlapped hints, hold SPACE to hide hints",(function(){o.create("",o.dispatchMouseClick)}),{repeatIgnore:!0}),h("v","#9Toggle visual mode",(function(){r.toggle()}),{repeatIgnore:!0}),h("n","#9Next found text",(function(){r.next(!1)}),{repeatIgnore:!0}),h("N","#9Previous found text",(function(){r.next(!0)}),{repeatIgnore:!0}),h(";fs","#1Display hints to focus scrollable elements",(function(){o.create(n.refreshScrollableElements(),o.dispatchMouseClick)})),g("q","#9Translate word under cursor",(function(){var e=K();l.readText(e);var t=r.getCursorPixelPos();c.performInlineQuery(e,{top:t.top,left:t.left,height:t.height,width:t.width},(function(e,t){a("showBubble",[e,t,!0])}))})),h("cq","#7Query word with Hints",(function(){o.create(d.conf.textAnchorPat,(function(e){var t,n,o,r=e[2].trim().replace(/[^A-z].*$/,""),i=F(e[0],e[1],e[2].length);void 0!==document.dictEnabled?document.dictEnabled&&window.postMessage({dictorium_data:{type:"OpenDictoriumQuery",word:r,sentence:(t=e[0],n=e[1],o="",_((function(e){e.setPosition(t,n),e.modify("extend","backward","sentence"),e.collapseToStart(),e.modify("extend","forward","sentence"),o=e.toString()})),o.replace(/\n/g,"")),pos:i,source:window.location.href}}):c.performInlineQuery(r,{top:i.top,left:i.left,height:i.height,width:i.width},(function(e,t){a("showBubble",[e,t,!1])}))}))})),{RUNTIME:s,aceVimMap:function(e,t,n){a("addVimMap",[e,t,n])},addVimMapKey:function(){a("addVimKeyMap",Array.from(arguments))},addSearchAlias:function(e,t,n,o,r,i,a,s){if(function(e,t,n,o,r,i){c.addSearchAlias(e,t,n,o,r,i)}(e,t,n,r,i,s),!(s?.skipMaps??!1)){h((o||"s")+e,"#6Search selected with "+t,u),h("o"+e,"#8Open Search with alias "+e,(()=>{c.openOmnibar({type:"SearchEngine",extra:e})})),g((o||"s")+e,"",u),h((o||"s")+(a||"o")+e,"",d),g((o||"s")+(a||"o")+e,"",d);var l=e.toUpperCase();if(l!==e){function f(){C(n,!1,!0,e)}function p(){C(n,!0,!0,e)}h((o||"s")+l,"",f),g((o||"s")+l,"",f),h((o||"s")+(a||"o")+l,"",p),g((o||"s")+(a||"o")+l,"",p)}}function u(){C(n)}function d(){C(n,!0)}},cmap:function(e,t,n,o){p(n)&&a("addMapkey",["Omnibar",e,t])},imap:function(e,n,o,r){p(o)&&W(t,e,n,r)},imapkey:y,insertJS:X,isElementPartiallyInViewport:N,getBrowserName:f,getClickableElements:P,getFormData:function(e,t){var n=new FormData(e);if("json"===t){var o={};return n.forEach((function(e,t){if(o.hasOwnProperty(t)){if(e.length){var n=o[t];"Array"===n.constructor.name?n.push(e):(o[t]=[],n.length&&o[t].push(n),o[t].push(e))}}else o[t]=e})),o}return new URLSearchParams(n).toString()},lmap:function(e,t,o,r){p(o)&&n.addLurkMap(e,t)},map:function(e,t,o,r){if(p(o))if(":"===t[0]&&t.length>1){var s=t.substr(1),l=u((function(){c.executeCommand(s)}),r?j({annotation:r}):null,!1);n.mappings.add(i.encodeKeystroke(e),l)}else!W(n,e,t,r)&&t in de.specialKeys?(de.specialKeys[t].push(e),a("addMapkey",["Mode",e,t])):S("warn",`${t} not found in normal mode.`)},unmap:b,unmapAllExcept:function(e,o){p(o)&&[n,t].forEach((function(t){for(var n=new pe,o=0,r=(e=e||[]).length;o<r;o++){var a=i.encodeKeystroke(e[o]),s=t.mappings.find(a);s&&n.add(a,s.meta)}delete t.mappings,t.mappings=n,t.map_node=n}))},iunmap:function(e,n){p(n)&&t.mappings.remove(i.encodeKeystroke(e))},vunmap:x,mapkey:h,readText:l.readText,removeSearchAlias:function(e,t,n){!function(e){c.removeSearchAlias(e)}(e),b((t||"s")+e),b("o"+e),x((t||"s")+e),b((t||"s")+(n||"o")+e),x((t||"s")+(n||"o")+e);var o=e.toUpperCase();o!==e&&(b((t||"s")+o),x((t||"s")+o),b((t||"s")+(n||"o")+o),x((t||"s")+(n||"o")+o))},searchSelectedWith:C,tabOpenLink:V,vmap:function(e,t,n,o){p(n)&&W(r,e,t,o)},vmapkey:g,Clipboard:e,Normal:{feedkeys:n.feedkeys,jumpVIMark:n.jumpVIMark,passThrough:n.passThrough,scroll:n.scroll},Hints:{click:o.click,create:o.create,dispatchMouseClick:o.dispatchMouseClick,style:o.style,setNumeric:o.setNumeric,setCharacters:o.setCharacters},Visual:{style:r.style},Front:{openOmnibar:c.openOmnibar,registerInlineQuery:c.registerInlineQuery,showEditor:c.showEditor,getUsage:c.getUsage,showBanner:v,showPopup:w}}};var Se=n(34),xe=n.n(Se);function Ce(e,t,n){for(var o in n)d.conf.hasOwnProperty(o)&&(d.conf[o]=n[o]);if("findHistory"in n&&(d.conf.lastQuery=n.findHistory.length?n.findHistory[0]:""),!n.showAdvanced&&(n.basicMappings&&function(e,t,n){const o=new Set(Object.keys(n)),r={};for(const i in n){const a=n[i];if(o.has(a)){const e=t.mappings.find(a);e&&(r[a]=e.meta)}""===a?t.mappings.remove(i):r.hasOwnProperty(i)?t.mappings.add(a,r[i]):e.map(a,i)}}(e,t,n.basicMappings),n.disabledSearchAliases))for(const t in n.disabledSearchAliases)e.removeSearchAlias(t);if(n.showAdvanced&&"snippets"in n&&n.snippets&&!p()){var r=function(e,t){var n={settings:{},error:""};try{new Function("settings","api",t)(n.settings,e)}catch(e){n.error=e.toString()}return n}(e,n.snippets);if(""!==r.error&&(window===top?w("[SurfingKeys] Error found in settings: "+r.error):console.log("[SurfingKeys] Error found in settings({0}): {1}".format(window.location.href,r.error))),!function(e){for(var t in e)return!1;return!0}(r.settings)){for(var o in a("setUserSettings",JSON.parse(JSON.stringify(r.settings))),r.settings)d.conf.hasOwnProperty(o)&&(d.conf[o]=r.settings[o],delete r.settings[o]);Object.keys(r.settings).length>0&&window===top&&s("updateSettings",{scope:"snippets",settings:r.settings})}}if(d.conf.showProxyInStatusBar&&"proxyMode"in n){var i=n.proxyMode;-1!==["byhost","always"].indexOf(n.proxyMode)&&(i="{0}: {1}".format(n.proxyMode,n.proxy)),a("showStatus",[[void 0,void 0,void 0,i]])}s("getState",{blocklistPattern:d.conf.blocklistPattern?d.conf.blocklistPattern.toJSON():void 0,lurkingPattern:d.conf.lurkingPattern?d.conf.lurkingPattern.toJSON():void 0},(function(e){let n=e.state;"disabled"===n?t.disable():"lurking"===n?n=t.startLurk():("application/pdf"!==document.contentType||e.noPdfViewer?t.enable():Ne.usePdfViewer(),de.showStatus()),window===top&&s("setSurfingkeysIcon",{status:n})}))}function Te(){const e=we(),t=ge(),n=me(t);n.enter(),he(n);const o=ve(t,n),r=ye(e,o),i=ke(t,n,o,r,Ne),c=Ee(e,t,n,o,r,i,Ne);return xe()(c),"function"==typeof Ne.plugin&&Ne.plugin({front:i}),a("defaultSettingsLoaded",{normal:n,api:c}),s("getSettings",null,(function(e){var t=e.settings;Ce(c,n,t),a("userSettingsLoaded",{settings:t,api:c,front:i})})),{normal:n,front:i,api:c}}function Oe(e){if(window.frameId=h(),d.on("settingsUpdated",(t=>{var n=t.settings;Ce(e.api,e.normal,n)})),d.conf.stealFocusOnLoad&&!p()&&document.body&&document.body.childElementCount>1){var t=k();t&&t.blur()}}let Ne;window.getFrameId=function(){return!window.frameId&&window.innerWidth>16&&window.innerHeight>16&&document.body&&document.body.childElementCount>0&&-1===d.conf.ignoredFrameHosts.indexOf(window.origin)&&(!window.frameElement||parseInt("0"+getComputedStyle(window.frameElement).zIndex)>=0&&window.frameElement.offsetWidth>16&&window.frameElement.offsetWidth>16)&&Oe(Te()),window.frameId},de.init(window===top?void 0:()=>{window.addEventListener("focus",(()=>{getFrameId()}),{once:!0})}),Ne={usePdfViewer:function(){window.location.replace(chrome.extension.getURL("/pages/pdf_viewer.html")+"?r="+document.URL)},readText:function(e,t){var n=(t=t||{enqueue:!0,voiceName:d.conf.defaultVoice}).verbose,o=/[\s\u00a0]/g,r=(n=t.verbose,t.onEnd);delete t.verbose,delete t.onEnd,s("read",{content:e,options:t},(function(t){if(n)if("start"===t.ttsEvent.type)w(e);else if("word"===t.ttsEvent.type){o.lastIndex=t.ttsEvent.charIndex;var i=o.exec(e);w(i?e.substr(0,t.ttsEvent.charIndex)+"<font style='font-weight: bold; text-decoration: underline'>"+e.substr(t.ttsEvent.charIndex,i.index-t.ttsEvent.charIndex+1)+"</font>"+e.substr(i.index):e.substr(0,t.ttsEvent.charIndex)+"<font style='font-weight: bold; text-decoration: underline'>"+e.substr(t.ttsEvent.charIndex)+"</font>")}else"end"===t.ttsEvent.type&&a("hidePopup");return!r||"end"!==t.ttsEvent.type&&"interrupted"!==t.ttsEvent.type||r(),"end"!==t.ttsEvent.type}))}}||{usePdfViewer:()=>{},readText:()=>{}},window===top?new Promise(((e,t)=>{window.location.href===chrome.extension.getURL("/pages/options.html")?import("./pages/options.js").then((t=>{t.default(s,i,de,$,f,J,q,C,Q,v),e(Te())})):e(Te())})).then((e=>{Oe(e),d.on("titleChanged",(function(){de.checkEventListener((()=>{e.front.detach(),Oe(e=Te()),e.front.attach()}))})),d.on("tabActivated",(function(){e.front.attach()})),d.on("tabDeactivated",(function(){e.front.detach()})),document.addEventListener("surfingkeys:ensureFrontEnd",(function(t){e.front.attach()})),window._setScrollPos=function(e,t){document.scrollingElement.scrollLeft=e,document.scrollingElement.scrollTop=t},s("tabURLAccessed",{title:document.title,url:window.location.href},(function(e){if(e.index>0){var t=function(){o=!0,document.title=n+" "+r},n=e.index,o=!1,r=document.title;new MutationObserver((function(e){o?o=!1:(r=document.title,t())})).observe(document.querySelector("title"),{childList:!0}),t(),d.on("tabIndexChange",(function(e,o,r){e.index!==n&&(n=e.index,t())}))}}))})):document.addEventListener("surfingkeys:iframeBoot",(()=>{Oe(Te())}),{once:!0})})()})();